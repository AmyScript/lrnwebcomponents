{"version":3,"file":"lrndesign-imagemap.umd.js","sources":["lib/lrndesign-imagemap-hotspot.js","lrndesign-imagemap.umd.js"],"sourcesContent":["import { html, Polymer } from \"@polymer/polymer/polymer-legacy.js\";\nimport \"@polymer/iron-a11y-keys/iron-a11y-keys.js\";\nimport \"@lrnwebcomponents/relative-heading/relative-heading.js\";\n/**\n * `lrndesign-imagemap-hotspot`\n * creates an accessible image map\n *\n * @customElement\n * @polymer\n * @demo demo/index.html\n */\nPolymer({\n  _template: html`\n    <style>\n      :host {\n        display: none;\n      }\n      :host #desc {\n        margin: 0 0 15px;\n      }\n      @media print {\n        :host {\n          display: block;\n        }\n      }\n    </style>\n    <relative-heading hidden\\$=\"[[!label]]\" id=\"heading\" text\\$=\"[[label]]\">\n    </relative-heading>\n    <div id=\"desc\"><slot></slot></div>\n`,\n\n  is: \"lrndesign-imagemap-hotspot\",\n\n  properties: {\n    /**\n     * Label for the hotspot\n     */\n    label: {\n      type: String,\n      value: null\n    },\n    /**\n     * Id of hotspot element inside the SVG\n     */\n    hotspotId: {\n      type: String,\n      value: null\n    }\n  },\n\n  setParentHeading: function(parent) {\n    this.$.heading._setParent(parent);\n  }\n});\n","import { html, Polymer } from \"@polymer/polymer/polymer-legacy.js\";\nimport { dom } from \"@polymer/polymer/lib/legacy/polymer.dom.js\";\nimport \"@polymer/iron-ajax/iron-ajax.js\";\nimport \"@polymer/iron-a11y-keys/iron-a11y-keys.js\";\nimport \"@polymer/paper-dialog/paper-dialog.js\";\nimport \"@lrnwebcomponents/relative-heading/relative-heading.js\";\nimport \"./lib/lrndesign-imagemap-hotspot.js\";\n/**\n * `lrndesign-imagemap`\n * creates an accessible image map\n *\n * @customElement\n * @polymer\n * @demo demo/index.html\n */\nPolymer({\n  _template: html`\n    <style>\n      :host {\n        display: block;\n      }\n      :host #buttons {\n        position: absolute;\n        left: -999999px;\n        top: 0;\n        overflow: hidden;\n        opacity: 0;\n      }\n      :host paper-dialog {\n        border: 1px solid #000;\n        border-radius: 4px;\n      }\n      :host paper-dialog > #title, \n      :host paper-dialog > #desc {\n        padding: 15px;\n        margin: 0;\n      }\n      :host paper-dialog > #title {\n        position: absolute;\n        left: -9999px;\n        overflow: hidden;\n        height: 0;\n        width: 0;\n      }\n      :host paper-dialog > #title > * {\n        margin: 0;\n      }\n      /*::slotted([hotspot]) {\n        display: none;\n      }*/\n      @media print {\n        :host > #svg {\n          display: none;\n        }\n        /*::slotted(#screen-only) {\n          display: none;\n        }\n        ::slotted([hotspot]) {\n          display: block;\n        }*/\n      }\n    </style>\n    <relative-heading hidden\\$=\"[[!label]]\" id=\"heading\" subtopic-of\\$=\"[[subtopicOf]]\" tag\\$=\"[[tag]]\" text\\$=\"[[label]]\">\n    </relative-heading>\n    <div id=\"desc\"><slot name=\"desc\"></slot></div>\n    <div id=\"svg\"></div>\n    <div id=\"buttons\"></div>\n    <slot></slot>\n    <paper-dialog id=\"hdetails\">\n      <div id=\"title\"></div>\n      <div id=\"desc\"></div>\n    </paper-dialog>\n    <iron-ajax auto=\"\" id=\"get_svg\" url=\"[[src]]\" handle-as=\"text\" on-response=\"_getSVGHandler\"></iron-ajax>\n`,\n\n  is: \"lrndesign-imagemap\",\n\n  properties: {\n    /**\n     * Label for the imagemap\n     */\n    label: {\n      type: String,\n      value: null\n    },\n    /**\n     * The path of the SVG\n     */\n    src: {\n      type: String,\n      value: null\n    },\n    /**\n     * The path of the SVG\n     */\n    hotspotDetails: {\n      type: Array,\n      value: []\n    },\n    /* \n     * optional: the id of the heading element that this imagemap is a subtopic of \n     */\n    subtopicOf: {\n      type: String,\n      value: null,\n      reflectToAttribute: true\n    },\n    /* \n     * optional: if subtopicOf is not set, start the content at a heading tag, eg. <h1/>, <h2/> ...\n     */\n    tag: {\n      type: String,\n      value: null,\n      reflectToAttribute: true\n    }\n  },\n\n  /**\n   * when ready, set an event for when the hdetails dialog is mouseout or blur\n   */\n  ready: function() {\n    let root = this;\n    this.$.hdetails.addEventListener(\"blur\", function() {\n      root.closeHotspot();\n    });\n    this.$.hdetails.addEventListener(\"mouseout\", function() {\n      root.closeHotspot();\n    });\n    this.$.hdetails.addEventListener(\"keyup\", function(e) {\n      if (e.keyCode === 13 || e.keyCode === 32) {\n        root.closeHotspot();\n      }\n    });\n    /*window.addEventListener('keypress',function(e){\n     if (e.target.getAttribute('aria-controls') === 'hdetails' || e.target.getAttribute('id') == 'hdetails'){\n       e.preventDefault();\n     }\n   });*/\n  },\n\n  /**\n   * Convert from svg text to an array in the table function\n   */\n  _getSVGHandler: function(e) {\n    let root = this,\n      temp = document.createElement(\"div\"),\n      getID = function(element, alt) {\n        if (element.getAttribute(\"id\") === null)\n          element.setAttribute(\"id\", alt);\n        return element.getAttribute(\"id\");\n      };\n    let setAriaLabelledBy = function(source, target, prefix) {\n      // adds title and desc elements to target and sets the aria-labelledby attribute\n      let svgElem = function(nodename) {\n        source = source !== null ? source : root;\n        //adds title or desc element to target\n        let attr = nodename === \"title\" ? \"label\" : nodename,\n          query = source.querySelector(\"#\" + attr);\n        var label = target.querySelector(nodename);\n        //if the target doesn't have the element, add it\n        if (label === null) {\n          label = document.createElement(nodename);\n          target.prepend(label);\n        }\n        //populates the element with data from the source element\n        if (source.getAttribute(attr) !== null) {\n          label.innerHTML = source.getAttribute(attr);\n        } else if (query !== null && query.innerHTML !== \"\") {\n          label.innerHTML = query.innerHTML;\n        }\n        //returns the new element's id\n        return getID(label, prefix + \"-\" + attr);\n      };\n      //set aria-labelledby to the id's for title and descriptions\n      target.setAttribute(\n        \"aria-labelledby\",\n        svgElem(\"desc\") + \" \" + svgElem(\"label\")\n      );\n    };\n    //set up main svg and append to document\n    temp.innerHTML = e.detail.response;\n    let svg = temp.querySelector(\"svg\"),\n      svgid = getID(svg, \"svg-\" + Date.now()),\n      hdata = dom(root).querySelectorAll(\"lrndesign-imagemap-hotspot\");\n    setAriaLabelledBy(root, svg, svgid);\n    this.$.svg.appendChild(svg);\n\n    for (let i = 0; i < hdata.length; i++) {\n      let hid = hdata[i].getAttribute(\"hotspot-id\"),\n        hotspot = svg.querySelector(\"#\" + hid),\n        clone = svg.cloneNode(true);\n\n      //clone svg for print versions and show hotspot as selected\n      setAriaLabelledBy(hdata[i], clone, hid);\n      hdata[i].appendChild(clone);\n      hdata[i].querySelector(\"#\" + hid).classList.add(\"selected\");\n      hdata[i].setParentHeading(root.$.heading);\n      for (let j = 0; j < hdata.length; j++) {\n        hdata[i]\n          .querySelector(\"#\" + hdata[j].getAttribute(\"hotspot-id\"))\n          .classList.add(\"hotspot\");\n      }\n\n      //configure hotspot on main (interactive) svg\n      let hbutton = document.createElement(\"button\");\n      hbutton.setAttribute(\"aria-controls\", \"hdetails\");\n      hbutton.setAttribute(\"tabindex\", 0);\n      hbutton.setAttribute(\"aria-label\", hdata[i].label);\n      root.$.buttons.appendChild(hbutton);\n      hbutton.addEventListener(\"focus\", function() {\n        console.log(\"focus\", i, hotspot);\n        hotspot.classList.add(\"focus\");\n      });\n      hbutton.addEventListener(\"blur\", function() {\n        hotspot.classList.remove(\"focus\");\n      });\n      hotspot.classList.add(\"hotspot\");\n      hotspot.addEventListener(\"click\", function(e) {\n        root.openHotspot(hotspot, hdata[i]);\n      });\n      hbutton.addEventListener(\"keyup\", function(e) {\n        if (e.keyCode === 13 || e.keyCode === 32) {\n          if (!hotspot.classList.contains(\"selected\")) {\n            root.openHotspot(hotspot, hdata[i]);\n          }\n        }\n      });\n    }\n  },\n\n  /**\n   * Selects a hotspot and opens hdetails dialog with details about it.\n   */\n  openHotspot: function(hotspot, details) {\n    let root = this,\n      node = dom(root).querySelector(\n        'lrndesign-imagemap-hotspot[hotspot-id=\"' +\n          hotspot.getAttribute(\"id\") +\n          '\"]'\n      );\n    this.$.hdetails.querySelector(\"#title\").innerHTML = details.getAttribute(\n      \"label\"\n    );\n    this.$.desc.appendChild(\n      document.createTextNode(details.querySelector(\"#desc\").innerHTML)\n    );\n    this.$.hdetails.positionTarget = hotspot;\n    this.__activeHotspot = hotspot;\n    this.$.hdetails.open();\n    this.resetHotspots();\n    hotspot.classList.add(\"selected\");\n  },\n\n  /**\n   * Closes a hotspot.\n   */\n  closeHotspot: function() {\n    this.$.hdetails.querySelector(\"#title\").innerHTML = \"\";\n    this.$.hdetails.querySelector(\"#desc\").innerHTML = \"\";\n    this.resetHotspots();\n    this.$.hdetails.close();\n    this.__activeHotspot.focus();\n  },\n\n  /**\n   * Closes hdetails dialog and deselects all hotspots.\n   */\n  resetHotspots: function() {\n    let hotspots = this.querySelectorAll('.hotspot[role=\"button\"]');\n    for (let i = 0; i < hotspots.length; i++) {\n      hotspots[i].classList.remove(\"selected\");\n    }\n  }\n});\n"],"names":["_template","html","is","properties","label","type","String","value","hotspotId","setParentHeading","parent","$","heading","_setParent","src","hotspotDetails","Array","subtopicOf","reflectToAttribute","tag","ready","root","this","hdetails","addEventListener","closeHotspot","e","keyCode","_getSVGHandler","temp","document","createElement","getID","element","alt","getAttribute","setAttribute","setAriaLabelledBy","source","target","prefix","svgElem","nodename","attr","query","querySelector","prepend","innerHTML","detail","response","svg","svgid","Date","now","hdata","dom","querySelectorAll","appendChild","i","hid","hotspot","clone","cloneNode","classList","add","j","length","hbutton","buttons","console","log","remove","openHotspot","contains","details","desc","createTextNode","positionTarget","__activeHotspot","open","resetHotspots","close","focus","hotspots"],"mappings":"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"}