{"version":3,"file":"lrndesign-imagemap.umd.js","sources":["lib/lrndesign-imagemap-hotspot.js","lrndesign-imagemap.umd.js"],"sourcesContent":["import { html, Polymer } from \"@polymer/polymer/polymer-legacy.js\";\nimport \"@polymer/iron-a11y-keys/iron-a11y-keys.js\";\nimport \"@lrnwebcomponents/relative-heading/relative-heading.js\";\n/**\n * `lrndesign-imagemap-hotspot`\n * creates an accessible image map\n *\n * @customElement\n * @polymer\n * @demo demo/index.html\n */\nPolymer({\n  _template: html`\n    <style>\n      :host {\n        display: none;\n      }\n      :host #desc {\n        margin: 0 0 15px;\n      }\n      @media print {\n        :host {\n          display: block;\n        }\n      }\n    </style>\n    <relative-heading hidden\\$=\"[[!label]]\" id=\"heading\" text\\$=\"[[label]]\">\n    </relative-heading>\n    <div id=\"desc\"><slot></slot></div>\n  `,\n\n  is: \"lrndesign-imagemap-hotspot\",\n\n  properties: {\n    /**\n     * Label for the hotspot\n     */\n    label: {\n      type: String,\n      value: null\n    },\n    /**\n     * Id of hotspot element inside the SVG\n     */\n    hotspotId: {\n      type: String,\n      value: null\n    }\n  },\n\n  setParentHeading: function(parent) {\n    this.$.heading._setParent(parent);\n  }\n});\n","import { html, Polymer } from \"@polymer/polymer/polymer-legacy.js\";\nimport { dom } from \"@polymer/polymer/lib/legacy/polymer.dom.js\";\nimport \"@polymer/iron-ajax/iron-ajax.js\";\nimport \"@polymer/iron-a11y-keys/iron-a11y-keys.js\";\nimport \"@lrnwebcomponents/simple-modal/simple-modal.js\";\nimport \"@lrnwebcomponents/relative-heading/relative-heading.js\";\nimport \"./lib/lrndesign-imagemap-hotspot.js\";\n/**\n * `lrndesign-imagemap`\n * creates an accessible image map\n *\n * @customElement\n * @polymer\n * @demo demo/index.html\n */\nlet LrndesignImagemap = Polymer({\n  _template: html`\n    <style>\n      :host {\n        display: block;\n      }\n      :host #buttons {\n        position: absolute;\n        left: -999999px;\n        top: 0;\n        overflow: hidden;\n        opacity: 0;\n      }\n      /*::slotted([hotspot]) {\n        display: none;\n      }*/\n      @media print {\n        :host > #svg {\n          display: none;\n        }\n        /*::slotted(#screen-only) {\n          display: none;\n        }\n        ::slotted([hotspot]) {\n          display: block;\n        }*/\n      }\n    </style>\n    <relative-heading\n      hidden\\$=\"[[!label]]\"\n      id=\"heading\"\n      subtopic-of\\$=\"[[subtopicOf]]\"\n      tag\\$=\"[[tag]]\"\n      text\\$=\"[[label]]\"\n    >\n    </relative-heading>\n    <div id=\"desc\"><slot name=\"desc\"></slot></div>\n    <div id=\"svg\"></div>\n    <div id=\"buttons\"></div>\n    <slot></slot>\n    <iron-ajax\n      auto=\"\"\n      id=\"get_svg\"\n      url=\"[[src]]\"\n      handle-as=\"text\"\n      on-response=\"_getSVGHandler\"\n    ></iron-ajax>\n  `,\n\n  is: \"lrndesign-imagemap\",\n\n  properties: {\n    /**\n     * Label for the imagemap\n     */\n    label: {\n      type: String,\n      value: null\n    },\n    /**\n     * The path of the SVG\n     */\n    src: {\n      type: String,\n      value: null\n    },\n    /**\n     * The path of the SVG\n     */\n    hotspotDetails: {\n      type: Array,\n      value: []\n    },\n    /*\n     * optional: the id of the heading element that this imagemap is a subtopic of\n     */\n    subtopicOf: {\n      type: String,\n      value: null,\n      reflectToAttribute: true\n    },\n    /*\n     * optional: if subtopicOf is not set, start the content at a heading tag, eg. <h1/>, <h2/> ...\n     */\n    tag: {\n      type: String,\n      value: null,\n      reflectToAttribute: true\n    }\n  },\n\n  /**\n   * attached life cycle\n   */\n  attached: function() {\n    window.simpleModal.requestAvailability();\n    window.addEventListener(\"simple-modal-closed\", e => {\n      if (e.detail.invokedBy === this) {\n        this.closeHotspot();\n      }\n    });\n  },\n  /**\n   * detached life cycle\n   */\n  detached: function() {\n    window.removeEventListener(\"simple-modal-closed\", e => {\n      if (e.detail.invokedBy === this) {\n        this.closeHotspot();\n      }\n    });\n  },\n\n  /**\n   * Convert from svg text to an array in the table function\n   */\n  _getSVGHandler: function(e) {\n    let root = this,\n      temp = document.createElement(\"div\"),\n      getID = function(element, alt) {\n        if (element.getAttribute(\"id\") === null)\n          element.setAttribute(\"id\", alt);\n        return element.getAttribute(\"id\");\n      };\n    let setAriaLabelledBy = function(source, target, prefix) {\n      // adds title and desc elements to target and sets the aria-labelledby attribute\n      let svgElem = function(nodename) {\n        source = source !== null ? source : root;\n        //adds title or desc element to target\n        let attr = nodename === \"title\" ? \"label\" : nodename,\n          query = source.querySelector(\"#\" + attr);\n        var label = target.querySelector(nodename);\n        //if the target doesn't have the element, add it\n        if (label === null) {\n          label = document.createElement(nodename);\n          target.prepend(label);\n        }\n        //populates the element with data from the source element\n        if (source.getAttribute(attr) !== null) {\n          label.innerHTML = source.getAttribute(attr);\n        } else if (query !== null && query.innerHTML !== \"\") {\n          label.innerHTML = query.innerHTML;\n        }\n        //returns the new element's id\n        return getID(label, prefix + \"-\" + attr);\n      };\n      //set aria-labelledby to the id's for title and descriptions\n      target.setAttribute(\n        \"aria-labelledby\",\n        svgElem(\"desc\") + \" \" + svgElem(\"label\")\n      );\n    };\n    //set up main svg and append to document\n    temp.innerHTML = e.detail.response;\n    let svg = temp.querySelector(\"svg\"),\n      svgid = getID(svg, \"svg-\" + Date.now()),\n      hdata = dom(root).querySelectorAll(\"lrndesign-imagemap-hotspot\");\n    setAriaLabelledBy(root, svg, svgid);\n    this.$.svg.appendChild(svg);\n\n    for (let i = 0; i < hdata.length; i++) {\n      let hid = hdata[i].getAttribute(\"hotspot-id\"),\n        hotspot = svg.querySelector(\"#\" + hid),\n        clone = svg.cloneNode(true);\n\n      //clone svg for print versions and show hotspot as selected\n      setAriaLabelledBy(hdata[i], clone, hid);\n      hdata[i].appendChild(clone);\n      hdata[i].querySelector(\"#\" + hid).classList.add(\"selected\");\n      hdata[i].setParentHeading(root.$.heading);\n      for (let j = 0; j < hdata.length; j++) {\n        hdata[i]\n          .querySelector(\"#\" + hdata[j].getAttribute(\"hotspot-id\"))\n          .classList.add(\"hotspot\");\n      }\n\n      //configure hotspot on main (interactive) svg\n      let hbutton = document.createElement(\"button\");\n      hbutton.setAttribute(\"tabindex\", 0);\n      hbutton.setAttribute(\"aria-label\", hdata[i].label);\n      root.$.buttons.appendChild(hbutton);\n      hbutton.addEventListener(\"focus\", function() {\n        console.log(\"focus\", i, hotspot);\n        hotspot.classList.add(\"focus\");\n      });\n      hbutton.addEventListener(\"blur\", function() {\n        hotspot.classList.remove(\"focus\");\n      });\n      hotspot.classList.add(\"hotspot\");\n      hotspot.addEventListener(\"click\", e => {\n        this.openHotspot(hotspot, hdata[i]);\n      });\n      hbutton.addEventListener(\"keyup\", e => {\n        if (e.keyCode === 13 || e.keyCode === 32) {\n          if (!hotspot.classList.contains(\"selected\")) {\n            this.openHotspot(hotspot, hdata[i]);\n          }\n        }\n      });\n    }\n  },\n\n  /**\n   * Selects a hotspot and opens dialog with details about it.\n   */\n  openHotspot: function(hotspot, details) {\n    // get everything flat\n    var children = details.$.desc\n      .querySelector(\"slot\")\n      .assignedNodes({ flatten: true });\n    let c = document.createElement(\"div\");\n    // append clones of the children we found\n    for (var child in children) {\n      c.appendChild(children[child].cloneNode(true));\n    }\n    const evt = new CustomEvent(\"simple-modal-show\", {\n      bubbles: true,\n      cancelable: true,\n      detail: {\n        title: details.getAttribute(\"label\"),\n        elements: {\n          content: c\n        },\n        invokedBy: this,\n        clone: false\n      }\n    });\n    this.dispatchEvent(evt);\n    this.__activeHotspot = hotspot;\n    this.resetHotspots();\n    hotspot.classList.add(\"selected\");\n  },\n\n  /**\n   * Closes a hotspot.\n   */\n  closeHotspot: function() {\n    this.resetHotspots();\n    this.__activeHotspot.focus();\n  },\n\n  /**\n   * Closes dialog and deselects all hotspots.\n   */\n  resetHotspots: function() {\n    let hotspots = this.querySelectorAll('.hotspot[role=\"button\"]');\n    for (let i = 0; i < hotspots.length; i++) {\n      hotspots[i].classList.remove(\"selected\");\n    }\n  }\n});\nexport { LrndesignImagemap };\n"],"names":["_template","html","is","properties","label","type","String","value","hotspotId","setParentHeading","parent","$","heading","_setParent","LrndesignImagemap","Polymer","src","hotspotDetails","Array","subtopicOf","reflectToAttribute","tag","attached","window","simpleModal","requestAvailability","addEventListener","e","detail","invokedBy","_this","closeHotspot","detached","removeEventListener","_this2","_getSVGHandler","root","this","temp","document","createElement","getID","element","alt","getAttribute","setAttribute","setAriaLabelledBy","source","target","prefix","svgElem","nodename","attr","query","querySelector","prepend","innerHTML","response","svg","svgid","Date","now","hdata","dom","querySelectorAll","appendChild","i","hid","hotspot","clone","cloneNode","classList","add","j","length","hbutton","buttons","console","log","remove","_this3","openHotspot","keyCode","contains","details","children","desc","assignedNodes","flatten","c","child","evt","CustomEvent","bubbles","cancelable","title","elements","content","dispatchEvent","__activeHotspot","resetHotspots","focus","hotspots"],"mappings":"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"}