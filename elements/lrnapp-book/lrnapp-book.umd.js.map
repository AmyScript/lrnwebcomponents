{"version":3,"file":"lrnapp-book.umd.js","sources":["lib/lrnapp-book-progress-dashboard.js","lrnapp-book.umd.js"],"sourcesContent":["import { html, Polymer } from \"@polymer/polymer/polymer-legacy.js\";\nimport \"@polymer/iron-icons/iron-icons.js\";\nimport \"@polymer/iron-icons/hardware-icons.js\";\nimport \"@polymer/iron-ajax/iron-ajax.js\";\nimport \"@polymer/paper-icon-button/paper-icon-button.js\";\nimport \"@polymer/paper-styles/color.js\";\nimport \"@lrnwebcomponents/paper-search/paper-search-bar.js\";\nimport \"@polymer/paper-tooltip/paper-tooltip.js\";\nimport \"@polymer/paper-slider/paper-slider.js\";\nimport \"@polymer/app-layout/app-layout.js\";\nimport \"@polymer/app-layout/app-drawer/app-drawer.js\";\nimport \"@polymer/app-layout/app-header/app-header.js\";\nimport \"@polymer/app-layout/app-toolbar/app-toolbar.js\";\nimport \"@polymer/app-layout/app-scroll-effects/app-scroll-effects.js\";\nimport \"@polymer/app-route/app-location.js\";\nimport \"@polymer/app-route/app-route.js\";\nimport \"@lrnwebcomponents/materializecss-styles/materializecss-styles.js\";\nimport \"@lrnwebcomponents/lrndesign-stepper/lrndesign-stepper.js\";\nimport \"@lrnwebcomponents/lrnsys-progress/lrnsys-progress.js\";\nimport \"@lrnwebcomponents/elmsln-loading/elmsln-loading.js\";\nimport \"@lrnwebcomponents/page-scroll-position/page-scroll-position.js\";\nimport \"@lrnwebcomponents/hax-body/hax-body.js\";\nimport \"@lrnwebcomponents/material-progress/material-progress.js\";\nimport \"@lrnwebcomponents/lrndesign-mapmenu/lrndesign-mapmenu.js\";\n\n/**\n`lrnapp-book-progress-dashboard`\nA LRN element\n\n@demo demo/index.html\n\n@microcopy\n  progress - the amount the student has moved through the active item(s)\n  active item - pages of content the user is engaging with\n  stats\n\n*/\nPolymer({\n  _template: html`\n    <style include=\"materializecss-styles\"></style>\n    <style>\n      :host {\n        display: block;\n      }\n      paper-progress {\n        --paper-progress-active-color: var(--paper-blue-300, blue);\n        --paper-progress-secondary-color: var(--paper-yellow-300, yellow);\n        --paper-progress-container-color: var(--paper-green-300, green);\n        height: 24px;\n        display: inline-block;\n        vertical-align: text-top;\n      }\n      lrndesign-avatar {\n        display: inline-block;\n      }\n      lrnsys-progress-circle {\n        font-size: 64px;\n      }\n      .progress-icon {\n        height: 40px;\n        width: 40px;\n        padding: 4px;\n        display: inline-block;\n        color: white;\n        background-color: var(--paper-gray-300, gray);\n        border-radius: 50%;\n      }\n      .progress-row {\n        display: block;\n        width: 100%;\n      }\n      .progress-left,\n      .progress-right {\n        padding: 16px;\n        display: inline-block;\n        height: 160px;\n        vertical-align: text-top;\n      }\n      material-progress-histo {\n        width: 100%;\n        @apply --paper-font-body2;\n      }\n      material-progress-bars {\n        width: 100%;\n        @apply --paper-font-body2;\n      }\n      material-progress-bars > .bar > span {\n        text-align: end;\n        font-size: 14.4px;\n        @apply --layout-flex;\n      }\n      .bar {\n        background-color: var(--paper-deep-orange-500);\n      }\n      .bar.run {\n        background-color: var(--paper-purple-500);\n      }\n      .bar.hello {\n        background-color: var(--paper-cyan-500);\n      }\n      .bar.world {\n        background-color: var(--paper-orange-500);\n      }\n    </style>\n    <iron-ajax id=\"dataajax\" url=\"[[sourcePath]]\" params=\"[[requestParams]]\" handle-as=\"json\" on-response=\"handleDataResponse\" last-response=\"{{readTimeData}}\"></iron-ajax>\n\n    <div id=\"bodyloading\" class=\"loading\">\n      <elmsln-loading color=\"grey-text\" size=\"large\"></elmsln-loading>\n      <h3 class=\"loading-text\">Loading content..</h3>\n    </div>\n    <div>\n    <material-progress-bars max=\"128\" bar-height=\"22\" animated=\"\">\n      <div class=\"bar\" data-value=\"21\">\n        <iron-icon icon=\"av:video-library\"></iron-icon>\n      </div>\n      <div class=\"bar run\" data-value=\"13\">\n        <iron-icon icon=\"maps:directions-run\"></iron-icon>\n      </div>\n      <div class=\"bar hello\" data-value=\"50\">\n        <iron-icon icon=\"maps:directions-bike\"></iron-icon>\n        <span>Hello</span>\n      </div>\n      <div class=\"bar world\" data-value=\"30\">\n        <span>World</span>\n      </div>\n    </material-progress-bars>\n    <material-progress-histo bar-height=\"22\" animated=\"\">\n      <div class=\"bar\" data-value=\"21\">\n        <iron-icon icon=\"maps:directions-walk\"></iron-icon>\n      </div>\n      <div class=\"bar run\" data-value=\"13\">\n        <iron-icon icon=\"maps:directions-run\"></iron-icon>\n      </div>\n      <div class=\"bar hello\" data-value=\"50\">\n        <iron-icon icon=\"maps:directions-bike\"></iron-icon>\n        <span>Hello</span>\n      </div>\n      <div class=\"bar world\" data-value=\"30\">\n        <span>World</span>\n      </div>\n    </material-progress-histo>\n    <template is=\"dom-repeat\" items=\"[[dashboardItems]]\" as=\"item\">\n      <div class=\"progress-row\">\n        <div class=\"progress-left\">\n          <lrnsys-progress-circle status=\"disabled\" class=\"flex\" icon=\"[[item.meta.icon]]\"></lrnsys-progress-circle>\n        </div>\n        <div class=\"progress-right\">\n          <h3 class=\"progress-item-title\">[[item.attributes.title]]</h3>\n          <div class=\"description-content\">\n            <div>\n              <lrn-icon icon=\"network\" class=\"progress-icon\"></lrn-icon>\n              <paper-progress value=\"70\" secondary-progress=\"80\"></paper-progress>\n            </div>\n            <div>\n              <lrndesign-avatar src=\"[[userData.user.avatar]]\" label=\"[[userData.user.display_name]]\"></lrndesign-avatar>\n              <paper-progress value=\"70\" secondary-progress=\"80\"></paper-progress>\n            </div>\n          </div>\n        </div>\n      </div>\n    </template>\n    </div>\n`,\n\n  is: \"lrnapp-book-progress-dashboard\",\n\n  properties: {\n    /**\n     * Data about the active route; this includes item type and id.\n     */\n    routeData: {\n      type: Object,\n      observer: \"_routeDataChanged\"\n    },\n    /**\n     * Params for the request for outline/book to load.\n     */\n    requestParams: {\n      type: Object,\n      value: {\n        node: null\n      }\n    },\n    /**\n     * Path to get data into the UI\n     */\n    sourcePath: {\n      type: String\n    },\n    /**\n     * Read time data\n     */\n    readTimeData: {\n      type: Object,\n      value: []\n    },\n    /**\n     * User data.\n     */\n    userData: {\n      type: Object,\n      value: []\n    },\n    /**\n     * If this is visible; useful for toggling / activating.\n     */\n    showProgress: {\n      type: Boolean,\n      value: false,\n      reflectToAttribute: true,\n      observer: \"_showProgressChanged\"\n    }\n  },\n\n  /**\n   * Notice route data has changed.\n   */\n  _routeDataChanged: function(newValue, oldValue) {\n    if (typeof newValue !== typeof undefined) {\n      this.requestParams[newValue.type] = newValue.id;\n      // if we're visible kick off the call\n      if (this.progressChanged) {\n        this.$.dataajax.generateRequest();\n      }\n    }\n  },\n\n  /**\n   * Showing element state has changed\n   */\n  _showProgressChanged: function(newValue, oldValue) {\n    // ensure we are visible\n    if (newValue && typeof this.routeData !== typeof undefined) {\n      this.$.dataajax.generateRequest();\n    }\n  },\n\n  /**\n   * Response data.\n   */\n  handleDataResponse: function(obj) {\n    let response = obj.detail.response.data;\n    // show the info\n    this.$.bodyloading.hidden = true;\n    // split the data into two sets\n    this.userData = response.userdata;\n    this.dashboardItems = this._toArray(response.items);\n    console.log(response);\n  },\n\n  /**\n   * Simple way to convert from object to array.\n   */\n  _toArray: function(obj) {\n    return Object.keys(obj).map(function(key) {\n      return obj[key];\n    });\n  }\n});\n","import { html, Polymer } from \"@polymer/polymer/polymer-legacy.js\";\nimport { dom } from \"@polymer/polymer/lib/legacy/polymer.dom.js\";\nimport { updateStyles } from \"@polymer/polymer/lib/mixins/element-mixin.js\";\nimport \"@polymer/iron-icons/iron-icons.js\";\nimport \"@polymer/iron-icons/hardware-icons.js\";\nimport \"@polymer/iron-ajax/iron-ajax.js\";\nimport \"@polymer/paper-icon-button/paper-icon-button.js\";\nimport \"@polymer/paper-styles/color.js\";\nimport \"paper-search/paper-search-bar.js\";\nimport \"@polymer/paper-tooltip/paper-tooltip.js\";\nimport \"@polymer/paper-slider/paper-slider.js\";\nimport \"@polymer/app-layout/app-layout.js\";\nimport \"@polymer/app-layout/app-drawer/app-drawer.js\";\nimport \"@polymer/app-layout/app-header/app-header.js\";\nimport \"@polymer/app-layout/app-toolbar/app-toolbar.js\";\nimport \"@polymer/app-layout/app-scroll-effects/app-scroll-effects.js\";\nimport \"@polymer/app-route/app-location.js\";\nimport \"@polymer/app-route/app-route.js\";\nimport \"@lrnwebcomponents/materializecss-styles/materializecss-styles.js\";\nimport \"@lrnwebcomponents/lrndesign-stepper/lrndesign-stepper.js\";\nimport \"@lrnwebcomponents/lrnsys-progress/lrnsys-progress.js\";\nimport \"@lrnwebcomponents/elmsln-loading/elmsln-loading.js\";\nimport \"@lrnwebcomponents/page-scroll-position/page-scroll-position.js\";\nimport \"@lrnwebcomponents/hax-body/hax-body.js\";\nimport \"@lrnwebcomponents/material-progress/material-progress.js\";\nimport \"@lrnwebcomponents/lrndesign-mapmenu/lrndesign-mapmenu.js\";\nimport \"./lib/lrnapp-book-progress-dashboard.js\";\n/**\n`lrnapp-book`\nA LRN element\n\n@demo demo/index.html\n\n@microcopy\n  node / circle - A progress circle on the line\n  nodes / items - the list of items in the progress bar\n  bubble - reserved for when events fire out of an element or value is tracking events\n  percentage - amount complete either in the bar or the nodes themselves\n  bar - the underlayed bar that's tracking overall progression\n  author mode - authoring mode\n*/\nPolymer({\n  _template: html`\n    <style include=\"materializecss-styles\"></style>\n    <style>\n      :host {\n        display: block;\n        font-size: 16px;\n        box-sizing: content-box;\n      }\n      #toolbar {\n        color: gray;\n        background-color: white;\n        padding: 0 8px;\n        margin: 0;\n        height: auto;\n        box-sizing: content-box;\n        transition: all .4s ease;\n      }\n      paper-button {\n        padding: 0;\n        margin: 0;\n        min-width: 16px;\n      }\n\n      hax-panel ::shadow app-drawer {\n        padding: 0;\n        top: 0;\n        bottom: 0;\n        position: absolute;\n        box-sizing: content-box;\n        margin-left: -300px;\n        --app-drawer-content-container: {\n          background-color: #fafafa;\n          padding: 0;\n          border-right: 1px solid #c8c8c8;\n          overflow: inherit;\n          width: 300px !important;\n        }\n      }\n      app-drawer {\n        padding: 0;\n        top: 0;\n        bottom: 0;\n        z-index: 1;\n        position: absolute;\n        box-sizing: content-box;\n        --app-drawer-content-container: {\n          background-color: #fafafa;\n          padding: 0;\n          border-right: 1px solid #c8c8c8;\n          overflow-y: scroll;\n          width: 300px !important;\n          box-shadow: 0 76px 8px 0 rgba(0, 0, 0, 0.4);\n          height: 100vh;\n          top: 0;\n          position: sticky;\n        }\n      }\n      hax-panel {\n        font-size: 12.8px;\n      }\n      hax-panel {\n      --app-drawer-content-container: {\n          background-color: #fafafa;\n          padding: 0;\n          border-right: 1px solid #c8c8c8;\n          overflow-y: scroll;\n          width: 300px !important;\n          box-shadow: 0 76px 8px 0 rgba(0, 0, 0, 0.4);\n          height: 100vh;\n          top: 0;\n          position: sticky;\n        }\n      }\n\n      lrndesign-stepper-button {\n        --lrndesign-stepper-btn-active: #f6f7f7;\n      }\n      lrndesign-stepper-button ::shadow paper-button {\n        margin: 0;\n        height: 48px;\n      }\n      lrndesign-stepper-button ::shadow .title-container.lrndesign-stepper-button {\n        padding: 0;\n        width: 100%;\n        right: unset;\n      }\n      lrndesign-stepper-button ::shadow .node-title.lrndesign-stepper-button {\n        font-size: 14.4px;\n        line-height: 24px;\n      }\n\n      .loading {\n        width: 100%;\n        z-index: 1000;\n        opacity: .9;\n        text-align: center;\n        align-content: space-around;\n        justify-content: center;\n        position: absolute;\n        background-color: white;\n        padding: 0;\n        margin: 0;\n        display: flex;\n        margin: 0 auto;\n        visibility: visible;\n        transition: visibility 1s, opacity 1s ease;\n      }\n      .loading elmsln-loading {\n        margin: 0 80px;\n        display: inline-flex;\n      }\n      #bodyloading {\n        height: 100%;\n        display: flex;\n        justify-content: center;\n      }\n      #bodyloading .loading,\n      #bodyloading elmsln-loading{\n        display: block;\n        height: 80px;\n      }\n      .outline-title {\n        margin-left: 8px;\n        max-width: 50%;\n      }\n      .content-nav-buttons {\n        top: 60%;\n        position: fixed;\n        opacity: .8;\n        padding: 0 4px;\n        height: 40%;\n        padding-top: 15%;\n        margin-top: -15%;\n      }\n      .content-nav-buttons:hover {\n        opacity: 1;\n      }\n      .prev {\n        left: 0;\n        order: 1;\n      }\n      .next {\n        right: 0;\n        transition: right .2s ease;\n        order: 2;\n      }\n      app-header {\n        width: 100%;\n        left: 0 !important;\n        z-index: 2 !important;\n        position: sticky !important;\n      }\n      app-header-layout {\n        margin: 0;\n        padding: 0;\n        width: 100%;\n      }\n      .content-body {\n        position: relative;\n        padding: 0;\n        margin: -48px 64px 80px 64px;\n        font-size: 16px;\n        transition:\n          margin .4s ease,\n          width .4s ease;\n      }\n\n      .content-nav-buttons paper-icon-button {\n        width: 64px;\n        height: 64px;\n        opacity: .4;\n        display: block;\n        visibility: visible;\n        transition:\n          opacity .4s linear,\n          visibility 1s linear,\n          height .4s ease,\n          width .4s ease;\n      }\n      .content-nav-buttons paper-icon-button:hover {\n        opacity: 1;\n      }\n      paper-tooltip {\n        --paper-tooltip-opacity: .96;\n      }\n      :host([drawer-opened]) .content-nav-buttons paper-icon-button {\n        width: 40px;\n        height: 40px;\n      }\n      :host([edit-mode]) .content-nav-buttons {\n        opacity: 0;\n        pointer-events: none;\n        visibility: hidden;\n      }\n      .content-title {\n        font-size: 22.4px;\n        margin: 0;\n        padding: 4px 0;\n        background-color: white;\n        top: 70px;\n        position: sticky;\n      }\n      .content-current {\n        min-height: 100vh;\n      }\n      .content-next {\n        background-color: grey;\n        opacity: .8;\n      }\n      #header {\n        position: sticky;\n        top: 0;\n        left: 0;\n        width: 100%;\n        color: black;\n        background-color: white;\n        z-index: 2;\n        padding: 0;\n        margin: 0;\n        opacity: 1;\n        box-sizing: content-box;\n        transition: all .4s ease;\n      }\n      app-drawer-layout {\n        font-family: sans-serif;\n      }\n      :host {\n        --app-drawer-width: 300px;\n      }\n      :host([full-width]) {\n        --app-drawer-width: 0px;\n      }\n      :host([drawer-opened]) .prev,\n      :host([edit-mode]) .prev {\n        left: 272px;\n      }\n      .progress-container {\n        width: 90%;\n        padding: 0;\n        margin: 0 0 0 16px;\n        overflow: visible;\n      }\n\n      [main-title] {\n        font-weight: lighter;\n        padding: .6em 0 0 0;\n        margin: 0;\n        height: 48px;\n        overflow-y: scroll;\n      }\n      [hidden] {\n        visibility: hidden !important;\n        opacity: 0 !important;\n        display: block !important;\n      }\n      paper-search-bar[hidden] {\n        display: none !important;\n      }\n      lrnsys-progress {\n        margin-top: 8px;\n        padding: 3.2px 0 0 0;\n        box-sizing: content-box;\n      }\n      lrnsys-progress lrnsys-progress-circle {\n        list-style-type: none;\n        box-sizing: content-box;\n      }\n\n      #bookdrawercontent {\n        overflow: scroll;\n        visibility: visible;\n        display: block;\n        opacity: 1;\n        transition: visibility 1s linear, opacity 1s linear;\n      }\n      @media (max-width: 1200px) {\n        :host .content-body {\n          font-size: 15.04px;\n        }\n      }\n      @media (max-width: 960px) {\n        :host .content-body {\n          font-size: 14.72px;\n        }\n      }\n      @media (max-width: 820px) {\n        :host .content-body {\n          font-size: 14.4px;\n        }\n      }\n      @media (max-width: 700px) {\n        :host .content-body {\n          font-size: 14.4px;\n        }\n      }\n      @media (max-width: 639px) {\n        app-drawer-layout {\n          top: 0;\n        }\n        [main-title] {\n          font-size: 12.8px;\n        }\n        .content-title {\n          font-size: 16px;\n        }\n        .outline-title {\n          position: absolute !important;\n          clip: rect(1px 1px 1px 1px); /* IE6, IE7 */\n          clip: rect(1px, 1px, 1px, 1px);\n          overflow: hidden;\n          height: 1px;\n        }\n        :host .content-body {\n          margin: 0 8px;\n          font-size: 14.4px;\n          width: 85%;\n        }\n        .content-nav-buttons {\n          position: relative;\n          display: flex;\n          top: unset;\n          padding: 0;\n          opacity: .8;\n          height: unset;\n          margin: 0;\n        }\n        .content-nav {\n          width: 100%;\n          display: flex;\n          justify-content: center;\n          align-items: center;\n          vertical-align: middle;\n        }\n        .next {\n          right: unset;\n        }\n      }\n      @media (max-width: 500px) {\n        [main-title] {\n          font-size: 11.2px;\n        }\n      }\n      /**\n       * Authoring section\n       */\n      #editbutton {\n        position: fixed;\n        bottom: 0;\n        right: 0;\n        margin: 32px;\n        padding: 8px;\n        width: 25.6px;\n        height: 25.6px;\n        visibility: visible;\n        opacity: 1;\n        transition: all .4s ease;\n      }\n      :host([edit-mode]) #editbutton {\n        width: 100%;\n        z-index: 100;\n        right: 0;\n        bottom: 0;\n        border-radius: 0;\n        margin: 0;\n        padding: 16px;\n        background-color: var(--paper-blue-500) !important;\n      }\n      :host([edit-mode]) #header {\n        background-color: var(--paper-grey-500);\n      }\n      :host([edit-mode]) #toolbar {\n        opacity: .5;\n      }\n      .your-progress-button {\n        padding-right: 16px;\n      }\n      #mapmenu {\n        padding: 16px 0;\n        overflow-x: hidden;\n      }\n      .course-title-drawer {\n        font-size: 19.2px;\n      }\n    </style>\n    <page-scroll-position value=\"{{scrollPosition}}\"></page-scroll-position>\n    <div id=\"anchor\"></div>\n    <iron-ajax id=\"outlineajax\" params=\"[[requestParams]]\" url=\"[[outlinePath]]\" handle-as=\"json\" on-response=\"handleOutlineResponse\" last-response=\"{{outlineData}}\"></iron-ajax>\n    <iron-ajax id=\"bookajax\" params=\"[[requestParams]]\" url=\"[[bookPath]]\" handle-as=\"json\" on-response=\"handleBookResponse\" last-response=\"{{bookData}}\"></iron-ajax>\n    <iron-ajax id=\"pageajax\" url=\"[[pagePath]]\" params=\"[[pageParams]]\" handle-as=\"json\" on-response=\"handlePageResponse\" last-response=\"{{pageData}}\"></iron-ajax>\n    <iron-ajax id=\"pageupdateajax\" url=\"[[pageUpdatePath]]\" params=\"[[pageParams]]\" method=\"PUT\" body=\"[[updatePageData]]\" content-type=\"application/json\" handle-as=\"json\" on-response=\"_handleUpdateResponse\"></iron-ajax>\n    <iron-ajax id=\"pagedeleteajax\" url=\"[[pageDeletePath]]\" params=\"[[pageParams]]\" method=\"DELETE\" content-type=\"application/json\" handle-as=\"json\" on-response=\"_handleDeleteResponse\"></iron-ajax>\n    <iron-ajax id=\"pagecreateajax\" url=\"[[pageCreatePath]]\" method=\"POST\" body=\"[[createRequestBody]]\" handle-as=\"json\" on-response=\"_ajaxCreateStubHandler\"></iron-ajax>\n\n    <app-location route=\"{{route}}\" query-params=\"{{queryParams}}\"></app-location>\n    <app-route route=\"{{route}}\" pattern=\"[[endPoint]]/:type/:id\" data=\"{{data}}\" tail=\"{{tail}}\" query-params=\"{{queryParams}}\">\n    </app-route>\n  <!-- body where most of the heavy lifting happens -->\n    <app-drawer-layout>\n      <hax-panel id=\"haxpanel\">\n        <span slot=\"post\">\n          <lrnsys-collapselist-item>\n          <span slot=\"label\"><div class=\"label\">Engagements</div></span>\n          <span slot=\"content\">\n            <hax-panel-item icon=\"touch-app\" icon-class=\"blue-text\" label=\"Interactive video\" event-name=\"h5p-interactive-video\" voice-command=\"insert interactive video\"></hax-panel-item>\n            <hax-panel-item icon=\"hardware:videogame-asset\" icon-class=\"red-text\" label=\"Self-check\" event-name=\"h5p-multiple-choice\" voice-command=\"insert self check\"></hax-panel-item>\n            <hax-panel-item icon=\"timeline\" icon-class=\"yellow-text text-darken-4\" label=\"Timeline\" event-name=\"timeline\" voice-command=\"insert timeline\"></hax-panel-item>\n            <hax-panel-item icon=\"maps:place\" icon-class=\"green-text\" label=\"Map\" event-name=\"map\" voice-command=\"insert map\"></hax-panel-item>\n            <hax-panel-item icon=\"social:share\" icon-class=\"pink-text\" label=\"JMOL\" event-name=\"jmol\" voice-command=\"insert molecule\"></hax-panel-item>\n            <hax-panel-item icon=\"social:poll\" icon-class=\"orange-text\" label=\"Poll\" event-name=\"poll\" voice-command=\"insert poll\"></hax-panel-item>\n          </span>\n        </lrnsys-collapselist-item>\n        <lrnsys-collapselist-item>\n          <span slot=\"label\"><div class=\"label\">Assessments</div></span>\n          <span slot=\"content\">\n            <hax-panel-item icon=\"assignment\" icon-class=\"yellow-text text-darken-2\" label=\"Assignment\" event-name=\"assignment\" voice-command=\"insert assignment\"></hax-panel-item>\n            <hax-panel-item icon=\"assessment\" icon-class=\"purple-text text-darken-2\" label=\"Quiz\" event-name=\"quiz\" voice-command=\"insert quiz\"></hax-panel-item>\n          </span>\n        </lrnsys-collapselist-item>\n      </span>\n      </hax-panel>\n      <app-drawer slot=\"drawer\" id=\"bookdrawer\" opened=\"{{drawerOpened}}\" swipe-open=\"\" transition-duration=\"150\">\n        <div id=\"bookdrawercontent\" style=\"height: 100%; overflow: auto;\" hidden\\$=\"[[!bookItems]]\">\n          <paper-search-bar hide-filter-button=\"\" hidden\\$=\"[[!showSearch]]\"></paper-search-bar>\n          <lrndesign-mapmenu id=\"mapmenu\" on-tap=\"_bookOutlineTap\">\n            <!-- Server response will populate this -->\n          </lrndesign-mapmenu>\n        </div>\n      </app-drawer>\n      <app-header-layout>\n        <app-header slot=\"header\" id=\"header\" shadow=\"\" fixed=\"\">\n          <div id=\"outlineloading\" class=\"loading\">\n            <elmsln-loading color=\"grey-text\" size=\"medium\"></elmsln-loading>\n            <elmsln-loading color=\"grey-text\" size=\"medium\"></elmsln-loading>\n            <elmsln-loading color=\"grey-text\" size=\"medium\"></elmsln-loading>\n          </div>\n          <app-toolbar id=\"toolbar\" sticky=\"\" class=\"tall\">\n            <div style=\"pointer-events: auto;\" class=\"menu-btn-wrap\">\n              <paper-icon-button style=\"pointer-events: auto;\" title=\"Content outline\" id=\"menubutton\" icon=\"menu\" on-tap=\"toggleBook\"></paper-icon-button>\n            </div>\n            <div spacer=\"\" class=\"outline-title\">[[outlineTitle]]</div>\n            <div spacer=\"\" main-title=\"\" style=\"pointer-events: auto;\">\n              <div class=\"progress-container\">\n                <lrnsys-progress sound-finish=\"[[soundFinish]]\" sound=\"[[sound]]\" complete-sound=\"[[completeSound]]\" finished-sound=\"[[finishedSound]]\" title=\"The steps to complete this lesson\" id=\"progress\" active=\"{{activePage}}\" items=\"{{outlineItems}}\" progressive-unlock=\"\" size=\"small\"></lrnsys-progress>\n              </div>\n            </div>\n            <div class=\"your-progress-button\">\n              <lrnsys-dialog body-append=\"\" modal=\"\" on-tap=\"progressdashboardopen\" header=\"Your progress\" alt=\"Your progress\">\n                <span slot=\"button\"><iron-icon icon=\"av:equalizer\"></iron-icon></span>\n                <div>\n                  <lrnapp-book-progress-dashboard id=\"progressdashboard\" source-path=\"[[progressDashboardPath]]\" route-data=\"[[data]]\"></lrnapp-book-progress-dashboard>\n                </div>\n              </lrnsys-dialog>\n            </div>\n          </app-toolbar>\n        </app-header>\n        <div class=\"content-body\">\n          <div id=\"current\" class=\"content-current\">\n            <h2 id=\"currenttitle\" class=\"content-title\">[[currentTitle]]</h2>\n            <div id=\"bodyloading\" class=\"loading\">\n              <elmsln-loading color=\"grey-text\" size=\"large\"></elmsln-loading>\n              <h3 class=\"loading-text\">Loading content..</h3>\n            </div>\n            <div>\n              <hax-body id=\"haxbody\">\n                <slot id=\"slottedarea\"></slot>\n              </hax-body>\n            </div>\n          </div>\n        </div>\n        <div class=\"content-nav\">\n          <div class=\"content-nav-buttons next\">\n            <paper-icon-button id=\"next\" title=\"[[nextLabel]]\" on-tap=\"_nextBtn\" icon=\"hardware:keyboard-arrow-right\" data-voicecommand=\"next page\" hidden\\$=\"[[!hasNextPage]]\"></paper-icon-button>\n            <paper-tooltip for=\"next\" position=\"left\" offset=\"0\" animation-delay=\"100\">\n              [[nextLabel]]\n            </paper-tooltip>\n          </div>\n          <div class=\"content-nav-buttons prev\">\n            <paper-icon-button id=\"prev\" title=\"[[prevLabel]]\" on-tap=\"_prevBtn\" icon=\"hardware:keyboard-arrow-left\" data-voicecommand=\"previous page\" hidden\\$=\"[[!hasPrevPage]]\"></paper-icon-button>\n            <paper-tooltip for=\"prev\" position=\"right\" offset=\"0\" animation-delay=\"100\">\n              [[prevLabel]]\n            </paper-tooltip>\n          </div>\n        </div>\n      </app-header-layout>\n    </app-drawer-layout>\n    <!-- edit mode if they have permissions -->\n    <paper-fab id=\"editbutton\" icon=\"editor:mode-edit\" class=\"red white-text\" hidden\\$=\"[[!currentPageData.page.meta.canUpdate]]\" data-voicecommand=\"Edit content\" on-tap=\"_toggleEditMode\" title=\"Tap to place content in edit mode.\"></paper-fab>\n    <paper-tooltip for=\"editbutton\" position=\"bottom\" offset=\"8\" animation-delay=\"100\">\n      <span id=\"fablabel\">edit mode</span>\n    </paper-tooltip>\n    <paper-toast id=\"toast\" horizontal-align=\"left\"></paper-toast>\n`,\n\n  is: \"lrnapp-book\",\n\n  listeners: {\n    \"progress.node-percent-milestone\": \"testMilestone\",\n    \"route-change\": \"_routeChange\",\n    \"hax-item-selected\": \"_haxOperation\",\n    \"hax-content-insert\": \"_haxContentInsert\"\n  },\n\n  observers: [\"_routeChanged(data, route, endPoint)\"],\n\n  properties: {\n    /**\n     * Path for getting progress dashboard data\n     */\n    progressDashboardPath: {\n      type: String\n    },\n    /**\n     * Option to display the search bar.\n     */\n    showSearch: {\n      type: Boolean,\n      reflectToAttribute: true,\n      value: false\n    },\n    /**\n     * Request body parameters for creating a new item.\n     */\n    createRequestBody: {\n      type: Object,\n      computed: \"_computeCreateRequestBody(currentPageData)\"\n    },\n    /**\n     * Data to be shipped off to the update endpoint.\n     */\n    updatePageData: {\n      type: Object,\n      value: {\n        id: null,\n        type: null,\n        attributes: {}\n      }\n    },\n    /**\n     * Path for updating content.\n     */\n    pageUpdatePath: {\n      type: String,\n      computed: \"_computePageUpdatePath(data, sourcePath)\"\n    },\n    /**\n     * Source path to the 'find one' end point\n     */\n    sourcePath: {\n      type: String\n    },\n    /**\n     * Edit / authoring mode.\n     */\n    editMode: {\n      type: Boolean,\n      value: false,\n      reflectToAttribute: true,\n      observer: \"_editModeChanged\"\n    },\n    /**\n     * Binding so we can style based on drawer status\n     * @type {Object}\n     */\n    drawerOpened: {\n      type: Boolean,\n      value: true,\n      reflectToAttribute: true\n    },\n    /**\n     * App route tracking.\n     */\n    route: {\n      type: Object,\n      notify: true\n    },\n    /**\n     * Title for the content\n     */\n    currentTitle: {\n      type: String\n    },\n    /**\n     * Title for the top of the bar\n     */\n    outlineTitle: {\n      type: String\n    },\n    /**\n     * Title for the top of the bar\n     */\n    bookTitle: {\n      type: String,\n      value: \"Course outline\"\n    },\n    /**\n     * If the sound should play on finish.\n     */\n    soundFinish: {\n      type: Boolean,\n      value: true\n    },\n    /**\n     * If the sound should play on complete.\n     */\n    sound: {\n      type: Boolean,\n      value: true\n    },\n    /**\n     * Completing a step sound.\n     */\n    completeSound: {\n      type: String,\n      value: \"\"\n    },\n    /**\n     * Finished sound file.\n     */\n    finishedSound: {\n      type: String,\n      value: \"\"\n    },\n    /**\n     * Distance through the present document so we can visualize\n     */\n    scrollPosition: {\n      type: Number,\n      value: 0,\n      observer: \"_scrollChanged\"\n    },\n    /**\n     * Track the active page exposed from the progress bar.\n     */\n    activePage: {\n      type: Number,\n      value: 0,\n      observer: \"_activePageChanged\"\n    },\n    /**\n     * Track the active outline to load data for the progress bar.\n     */\n    activeOutline: {\n      type: Number,\n      value: 0,\n      observer: \"_activeOutlineChanged\"\n    },\n    /**\n     * List of items in our outline presently.\n     */\n    outlineItems: {\n      type: Array,\n      value: [],\n      notify: true,\n      observer: \"_outlineItemsChanged\"\n    },\n    /**\n     * List of items in our book presently.\n     */\n    bookItems: {\n      type: Array,\n      value: [],\n      notify: true\n    },\n    /**\n     * Item responses.\n     */\n    itemResponses: {\n      type: Array,\n      value: []\n    },\n    /**\n     * Params for the request for outline/book to load.\n     */\n    requestParams: {\n      type: Object,\n      notify: true,\n      value: {\n        node: null\n      }\n    },\n    /**\n     * Params for the request for content to load.\n     */\n    pageParams: {\n      type: Object,\n      notify: true,\n      value: {\n        load: false\n      }\n    },\n    /**\n     * Returned data for processing.\n     */\n    outlineData: {\n      type: Object,\n      notify: true\n    },\n    /**\n     * Returned data for processing.\n     */\n    bookData: {\n      type: Object,\n      notify: true\n    },\n    /**\n     * Returned data for processing.\n     */\n    pageData: {\n      type: Object,\n      notify: true\n    },\n    /**\n     * data pathway that expects the present outline returned.\n     */\n    outlinePath: {\n      type: String\n    },\n    /**\n     * data pathway that expects the book chapters returned.\n     */\n    bookPath: {\n      type: String\n    },\n    /**\n     * data pathway that expects the book chapters returned.\n     */\n    pagePath: {\n      type: String\n    },\n    /**\n     * Simple flag for having the previous button show.\n     */\n    hasPrevPage: {\n      type: Boolean,\n      notify: true\n    },\n    /**\n     * Previous page title.\n     */\n    prevLabel: {\n      type: String\n    },\n    /**\n     * Simple flag for having the next button show.\n     */\n    hasNextPage: {\n      type: Boolean,\n      notify: true\n    },\n    /**\n     * Next page title.\n     */\n    nextLabel: {\n      type: String\n    },\n    /**\n     * Ensure scrolling doesn't influence during a transition.\n     */\n    resetScroll: {\n      type: Boolean,\n      value: false\n    },\n    /**\n     * Store current page data.\n     */\n    currentPageData: {\n      type: Object,\n      value: {},\n      observer: \"_currentPageDataUpdated\"\n    },\n    /**\n     * Store current page data.\n     */\n    responseData: {\n      type: Object,\n      value: {}\n    },\n    /**\n     * Rebuild outline flag so we know to call it on page build.\n     */\n    rebuildOutline: {\n      type: Boolean,\n      value: false\n    },\n    /**\n     * Track if we should go full width or not.\n     */\n    fullWidth: {\n      type: Boolean,\n      reflectToAttribute: true,\n      value: false,\n      observer: \"_fullWidthChanged\"\n    }\n  },\n\n  /**\n   * Ready event.\n   */\n  ready: function(e) {\n    this.$.bodyloading.hidden = true;\n    // fire an outline request to kick things off!\n    this.$.outlineajax.generateRequest();\n\n    // scroll top into view\n    setTimeout(() => {\n      this._resetScroll();\n    }, 500);\n  },\n\n  /**\n   * When element is told to be full width it'll close things.\n   */\n  _fullWidthChanged: function(newValue, oldValue) {\n    updateStyles();\n  },\n\n  /**\n   * Handle click on dashboard to trigger loading data.\n   */\n  progressdashboardopen: function(e) {\n    this.$.progressdashboard.showProgress = true;\n  },\n\n  /**\n   * Generate path to point to the right endpoint for updating items.\n   */\n  _computePageUpdatePath: function(data, sourcePath) {\n    return sourcePath.replace(\"%\", data.id);\n  },\n\n  /**\n   * Hax operation capture and UI routing.\n   */\n  _haxOperation: function(e) {\n    this.$.toast.show(e.detail.eventName);\n  },\n\n  /**\n   * HAX Content Insert.\n   */\n  _haxContentInsert: function(e) {\n    this.$.toast.show(e.detail.eventName);\n    var properties = {};\n    // support for properties to be set automatically optionally\n    if (typeof e.detail.properties !== typeof undefined) {\n      properties = e.detail.properties;\n    }\n    this.$.haxbody.haxInsert(e.detail.tag, e.detail.content, properties);\n  },\n\n  /**\n   * Calculate what would happen if we added a page here.\n   */\n  _computeCreateRequestBody: function(currentPageData) {\n    if (typeof currentPageData.page !== typeof undefined) {\n      return {\n        bid: currentPageData.page.relationships.book.id,\n        pid: currentPageData.page.relationships.parent.id\n      };\n    }\n  },\n\n  /**\n   * Simple state toggle for edit button being pressed.\n   */\n  _toggleEditMode: function(e) {\n    this.editMode = !this.editMode;\n  },\n\n  /**\n   * React when state changes for editMode\n   */\n  _editModeChanged: function(newValue, oldValue) {\n    if (typeof newValue !== typeof undefined) {\n      if (newValue === true) {\n        // update the button to be for saving state\n        this.$.editbutton.icon = \"save\";\n        this.$.editbutton.title = \"Tap to save content and exit edit mode\";\n        this.$.fablabel = \"save changes\";\n        // simple way to remember state of opened drawer\n        this.__bookdraweropened = this.$.bookdrawer.opened;\n        // close the menu to give us more room to work\n        if (this.$.bookdrawer.opened) {\n          this.$.bookdrawer.opened = false;\n        }\n        // open the haxpanel\n        this.$.haxpanel.opened = true;\n        // play things in an editable state and let hax take over from here\n        this.$.currenttitle.contentEditable = true;\n        this.$.haxbody.editMode = true;\n        // block scroll tracking during edit mode\n        this.resetScroll = true;\n        // notification to user\n        this.$.toast.show(\"Authoring mode active\");\n      } else {\n        // reset visuals\n        this.$.editbutton.icon = \"editor:mode-edit\";\n        this.$.editbutton.title = \"Tap to place content in edit mode.\";\n        this.$.fablabel = \"edit mode\";\n        this.$.bookdrawer.opened = this.__bookdraweropened;\n        // open the haxpanel\n        this.$.haxpanel.opened = false;\n        // play things in an editable state and let hax take over from here\n        this.$.currenttitle.contentEditable = false;\n        this.$.haxbody.editMode = false;\n        // allow scrolling to take place now\n        this.resetScroll = false;\n        // we were in edit mode, now time to save for real\n        if (oldValue === true) {\n          let updated = false;\n          // get computed / cleaned up content area\n          let haxcontent = this.$.haxbody.haxToContent();\n          // see if title changed\n          if (this.$.currenttitle.innerHTML !== this.currentPageData.title) {\n            this.currentPageData.title = this.$.currenttitle.innerHTML;\n            this.updatePageData.attributes.title = this.currentPageData.title;\n          }\n          // see if content updated\n          if (this.currentPageData.content !== haxcontent) {\n            this.currentPageData.content = haxcontent;\n            this.updatePageData.attributes.body = this.currentPageData.content;\n            updated = true;\n          }\n          // see if we've changed anything in order to ship off\n          if (updated) {\n            // set type and id data from routing and ship this off!\n            this.updatePageData.type = this.data.type;\n            this.updatePageData.id = this.data.id;\n            this.$.toast.show(\"Saving...\");\n            this.$.pageupdateajax.generateRequest();\n          }\n        }\n      }\n    }\n  },\n\n  /**\n   * Get response back from the server on updating this content.\n   */\n  _handleUpdateResponse: function(e) {\n    // @todo error checking here\n    this.$.toast.show(\"Saved!\");\n  },\n\n  /**\n   * Change the activeOutline\n   */\n  _bookOutlineTap: function(e) {\n    var normalizedEvent = dom(e);\n    var local = normalizedEvent.localTarget;\n    // support switching if the thing clicked has a book index associated\n    if (typeof local.getAttribute(\"data-book-parent\") !== typeof undefined) {\n      this.activeOutline = local.getAttribute(\"data-book-parent\");\n    }\n  },\n\n  /**\n   * A book level button was pressed, we need to invoke a change of\n   * content as well as outline.\n   */\n  _activeOutlineChanged: function(newValue, oldValue) {\n    if (\n      typeof newValue !== typeof undefined &&\n      typeof oldValue !== typeof undefined\n    ) {\n      // trigger loading state\n      this.rebuildOutline = true;\n    }\n  },\n\n  /**\n   * If the current route is outside the scope of our app then allow\n   * the website to break out of the single page application routing.\n   */\n  _routeChanged: function(data, route, endPoint) {\n    if (typeof route.path === \"string\") {\n      if (typeof endPoint === \"string\") {\n        if (route.path.startsWith(endPoint)) {\n          // trigger change if data location changed\n          if (\n            this.pageParams.load != false &&\n            typeof data.type !== typeof undefined &&\n            typeof data.id !== typeof undefined\n          ) {\n            // prime the page request parameters\n            this.pageParams[data.type] = data.id;\n            // test if we already have this request\n            if (\n              typeof this.responseData[data.type + data.id] !== typeof undefined\n            ) {\n              this.set(\n                \"currentPageData\",\n                this.responseData[data.type + data.id]\n              );\n            } else {\n              // trigger loading state\n              this.$.bodyloading.hidden = false;\n              // send request out the door to the actual end point\n              this.$.pageajax.generateRequest();\n            }\n            // support for being told to rebuild the outline\n            if (this.rebuildOutline) {\n              // dirty rebuild of params\n              this.set(\"requestParams\", []);\n              // our page params have the current page in scope\n              this.set(\"requestParams\", this.pageParams);\n              // test if we already have this request\n              if (\n                typeof this.responseData[\n                  data.type + \".\" + data.id + \".outline\"\n                ] !== typeof undefined\n              ) {\n                this.activePage = 0;\n                this.set(\"outlineItems\", []);\n                this.set(\n                  \"outlineItems\",\n                  this._toArray(\n                    this.responseData[data.type + \".\" + data.id + \".outline\"]\n                      .items\n                  )\n                );\n                this.set(\n                  \"outlineTitle\",\n                  this.responseData[data.type + \".\" + data.id + \".outline\"]\n                    .items.outlineTitle\n                );\n              } else {\n                this.$.outlineloading.hidden = false;\n                this.pageParams.load = false;\n                // send request out the door to the actual end point\n                this.$.outlineajax.generateRequest();\n              }\n              this.rebuildOutline = false;\n            }\n          }\n          return;\n        }\n      }\n      // reload the page which since route changed will load that page\n      window.location.reload();\n    }\n  },\n\n  /**\n   * Reset scroll position visually and internally data wise.\n   */\n  _resetScroll: function() {\n    this.resetScroll = true;\n    this.scrollPosition = 0;\n    this.$.anchor.scrollIntoView({\n      block: \"start\",\n      behavior: \"smooth\",\n      inline: \"nearest\"\n    });\n  },\n\n  /**\n   * React to active page being changed.\n   */\n  _activePageChanged: function(newValue, oldValue) {\n    if (typeof newValue !== typeof undefined) {\n      if (typeof this.outlineItems !== typeof undefined) {\n        this.set(\"route.path\", this.outlineItems[newValue].url);\n        // ensure that we clear any previously set update data\n        this.updatePageData.attributes = {};\n        this.updatePageData.id = null;\n        this.updatePageData.type = null;\n      }\n      // scroll into view the container that's about to be swapped out\n      if (typeof oldValue !== typeof undefined) {\n      }\n      // ensure that scrolling percentage doesn't increase the next item\n      // while active is being changed\n      setTimeout(() => {\n        this.resetScroll = false;\n      }, 1000);\n\n      // manage the previous page button on the UI\n      if (newValue == 0) {\n        this.hasPrevPage = false;\n      } else {\n        this.hasPrevPage = true;\n        if (typeof this.outlineItems !== typeof undefined) {\n          this.prevLabel = this.outlineItems[newValue - 1].title;\n        }\n      }\n      // manage next page button on the UI\n      if (\n        typeof this.outlineItems !== typeof undefined &&\n        newValue + 1 == this.outlineItems.length\n      ) {\n        this.hasNextPage = false;\n      } else {\n        this.hasNextPage = true;\n        if (typeof this.outlineItems !== typeof undefined) {\n          this.nextLabel = this.outlineItems[newValue + 1].title;\n        }\n      }\n    }\n  },\n\n  /**\n   * React to items being changed.\n   */\n  _outlineItemsChanged: function(newValue, oldValue) {\n    // these need set immediately\n    if (typeof newValue !== typeof undefined && newValue.length != 0) {\n      // manage the previous page button on the UI\n      if (this.activePage != 0) {\n        this.prevLabel = newValue[this.activePage - 1].title;\n      }\n      // manage next page button on the UI\n      if (this.activePage + 1 != newValue.length) {\n        this.nextLabel = newValue[this.activePage + 1].title;\n      }\n    }\n  },\n\n  /**\n   * Test what milestone has been hit and if we should start to preload\n   * items as a result of it!\n   */\n  testMilestone: function(e) {\n    // we should preload the next page\n    if (e.detail.percentage == 75) {\n      console.log(\n        \"@todo preload the next page and present grayed out right of UI.\"\n      );\n    }\n  },\n\n  /**\n   * Pass down scroll change to the element for progress visualization.\n   */\n  _scrollChanged: function(newValue, oldValue) {\n    // only evaluate scroll if value is greater then previous\n    if (\n      typeof this.outlineItems !== typeof undefined &&\n      typeof this.outlineItems[this.activePage] !== typeof undefined &&\n      newValue > this.outlineItems[this.activePage].value &&\n      !this.resetScroll\n    ) {\n      // once we get 90% of the way through the material consider it finished\n      if (newValue >= 75) {\n        this.outlineItems[this.activePage].value = this.outlineItems[\n          this.activePage\n        ].max;\n        this.set(\n          \"outlineItems.\" + this.activePage + \".value\",\n          this.outlineItems[this.activePage].max\n        );\n      } else {\n        this.outlineItems[this.activePage].value = newValue;\n        this.set(\"outlineItems.\" + this.activePage + \".value\", newValue);\n      }\n    }\n  },\n\n  /**\n   * Pass down the click to the next page if we have one\n   */\n  _nextBtn: function(e) {\n    // make sure we are able to move forward more\n    if (this.activePage < this.outlineItems.length - 1) {\n      this.set(\n        \"outlineItems.\" + this.activePage + \".value\",\n        this.outlineItems[this.activePage].max\n      );\n      this.activePage = this.activePage + 1;\n    }\n  },\n\n  /**\n   * Pass down the click to the prev page if we have one\n   */\n  _prevBtn: function(e) {\n    if (this.activePage > 0) {\n      this.activePage = this.activePage - 1;\n    }\n  },\n\n  /**\n   * Toggle the book drawer\n   */\n  toggleBook: function(e) {\n    // if we are in edit mode then we ned to close this\n    if (this.editMode) {\n      this.$.haxpanel.toggle();\n      this.fullWidth = !this.$.haxpanel.opened;\n    } else {\n      this.$.bookdrawer.toggle();\n      this.fullWidth = !this.$.bookdrawer.opened;\n    }\n  },\n\n  /**\n   * Handle the response.\n   */\n  handleOutlineResponse: function(obj) {\n    if (typeof obj !== typeof undefined) {\n      const response = obj.detail.response.data;\n      const items = this._toArray(obj.detail.response.data.items);\n      const outlineTitle = obj.detail.response.data.outlineTitle;\n      // set active to 0 because once we update the outlineItems it will try to\n      // pick a title and be out of sync for a moment in time\n      if (this.activePage !== 0) {\n        this.activePage = 0;\n      }\n      // store the response for the outline object data to skip future calls\n      this.set(\n        \"responseData.\" + this.data.type + \".\" + this.data.id + \".outline\",\n        response\n      );\n      // set outline items to repaint, aggressively\n      this.set(\"outlineItems\", []);\n      this.set(\"outlineItems\", items);\n      // set title to match new parent title\n      this.set(\"outlineTitle\", outlineTitle);\n      var activePage = 0;\n      // see if we can find a match of routing for an active page\n      for (var i in items) {\n        // we have a match; usually this would only happen on initial page load\n        if (\n          this.data.type === items[i].type &&\n          this.data.id === items[i].id &&\n          i !== 0\n        ) {\n          activePage = parseInt(i);\n        }\n      }\n      if (activePage !== 0) {\n        this.activePage = activePage;\n      }\n      this.$.outlineloading.hidden = true;\n      this.pageParams.load = true;\n      // only repopulate the first time\n      if (this.bookItems.length === 0) {\n        this.$.bookajax.generateRequest();\n        // kick off page request to since we paint it into slot early\n        // this allows us to do admin user perm checking on initial load\n        this.pageParams = this.requestParams;\n        this.$.pageajax.generateRequest();\n      }\n    }\n  },\n\n  /**\n   * Handle the response.\n   */\n  handleBookResponse: function(obj) {\n    const response = obj.detail.response.data;\n    this.set(\"bookItems\", this._toArray(response.items));\n    // rip the items into the DOM\n    // @todo might need to do the append HTML trick\n    this.$.mapmenu.innerHTML = response.render;\n  },\n\n  /**\n   * Page response callback.\n   */\n  handlePageResponse: function(obj) {\n    if (typeof obj !== typeof undefined) {\n      const response = obj.detail.response.data;\n      this.set(\"responseData.\" + this.data.type + this.data.id, response);\n      this.set(\"currentPageData\", response);\n    }\n  },\n\n  /**\n   * Handle page object getting updated. This allows\n   * for updating parts of the page either from the localcache\n   * or from the ajax call.\n   */\n  _currentPageDataUpdated: function(newValue, oldValue) {\n    if (\n      typeof newValue !== typeof undefined &&\n      typeof newValue.content !== typeof undefined\n    ) {\n      // set page title; easiest for sure\n      this.set(\"currentTitle\", newValue.title);\n      // when updating data we need to clear the slot's content\n      // while maintaining the data model correctly\n      let slot = dom(this.$.haxbody);\n      while (slot.firstChild !== null) {\n        slot.removeChild(slot.firstChild);\n      }\n      // add HTML to a div which makes it's DOM unpack\n      var tmp = document.createElement(\"div\");\n      let frag = document\n        .createRange()\n        .createContextualFragment(newValue.content);\n      tmp.appendChild(frag);\n      // trap for text without wrapping HTML tags\n      if (tmp.firstChild == null) {\n        var tmp2 = document.createElement(\"p\");\n        tmp2.innerHTML = tmp.innerHTML;\n        tmp = document.createElement(\"div\");\n        tmp.innerHTML = tmp2.outerHTML;\n      } else if (typeof tmp.firstChild.length !== typeof undefined) {\n        var tmp2 = document.createElement(\"p\");\n        tmp2.innerHTML = tmp.innerHTML;\n        tmp = document.createElement(\"div\");\n        tmp.innerHTML = tmp2.outerHTML;\n      }\n      // same as above but in reverse; now take stuf from what\n      // came across and correctly add it into the slot\n      while (tmp.firstChild) {\n        dom(this.$.haxbody).appendChild(tmp.firstChild);\n      }\n      // reset scroll position back to top of this content\n      this._resetScroll();\n      // hide the loading area\n      this.$.bodyloading.hidden = true;\n      // manage state associated w/ edit mode if we were in edit mode previously\n      if (this.editMode && !newValue.page.meta.canUpdate) {\n        this.editMode = false;\n      }\n    }\n  },\n\n  /**\n   * Simple way to convert from object to array.\n   */\n  _toArray: function(obj) {\n    return Object.keys(obj).map(function(key) {\n      return obj[key];\n    });\n  }\n});\n"],"names":["_template","html","is","properties","routeData","type","Object","observer","requestParams","value","node","sourcePath","String","readTimeData","userData","showProgress","Boolean","reflectToAttribute","_routeDataChanged","newValue","oldValue","_typeof","id","this","progressChanged","$","dataajax","generateRequest","_showProgressChanged","handleDataResponse","obj","response","detail","data","bodyloading","hidden","userdata","dashboardItems","_toArray","items","console","log","keys","map","key","listeners","observers","progressDashboardPath","showSearch","createRequestBody","computed","updatePageData","attributes","pageUpdatePath","editMode","drawerOpened","route","notify","currentTitle","outlineTitle","bookTitle","soundFinish","sound","completeSound","finishedSound","scrollPosition","Number","activePage","activeOutline","outlineItems","Array","bookItems","itemResponses","pageParams","load","outlineData","bookData","pageData","outlinePath","bookPath","pagePath","hasPrevPage","prevLabel","hasNextPage","nextLabel","resetScroll","currentPageData","responseData","rebuildOutline","fullWidth","ready","e","outlineajax","setTimeout","_this","_resetScroll","_fullWidthChanged","updateStyles","progressdashboardopen","progressdashboard","_computePageUpdatePath","replace","_haxOperation","toast","show","eventName","_haxContentInsert","haxbody","haxInsert","tag","content","_computeCreateRequestBody","page","bid","relationships","book","pid","parent","_toggleEditMode","_editModeChanged","editbutton","icon","title","fablabel","__bookdraweropened","bookdrawer","opened","haxpanel","currenttitle","contentEditable","updated","haxcontent","haxToContent","innerHTML","body","pageupdateajax","_handleUpdateResponse","_bookOutlineTap","local","dom","localTarget","getAttribute","_activeOutlineChanged","_routeChanged","endPoint","path","startsWith","set","pageajax","outlineloading","window","location","reload","anchor","scrollIntoView","block","behavior","inline","_activePageChanged","url","_this2","length","_outlineItemsChanged","testMilestone","percentage","_scrollChanged","max","_nextBtn","_prevBtn","toggleBook","toggle","handleOutlineResponse","i","parseInt","bookajax","handleBookResponse","mapmenu","render","handlePageResponse","_currentPageDataUpdated","slot","firstChild","removeChild","tmp","document","createElement","frag","createRange","createContextualFragment","appendChild","tmp2","outerHTML","meta","canUpdate"],"mappings":"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"}