{"version":3,"file":"json-outline-schema.umd.js","sources":["lib/json-outline-schema-item.js","json-outline-schema.umd.js"],"sourcesContent":["/**\n * Copyright 2019 The Pennsylvania State University\n * @license Apache-2.0, see License.md for full text.\n */\n/**\n * `json-outline-schema-item`\n * `A single item inside of json outline schema's items array`\n *\n * @microcopy - language worth noting:\n *  - outline-schema - a schema for expressing the relationship between structured content items\n *  - item - one item within an outline with reference to a resource to load the contents of the item\n */\nclass JSONOutlineSchemaItem {\n  /**\n   * Establish defaults for a new item\n   */\n  constructor() {\n    this.id = \"item-\" + this.generateUUID();\n    this.ident = 0;\n    this.location = \"\";\n    this.order = 0;\n    this.parent = \"\";\n    this.title = \"New item\";\n    this.description = \"\";\n    this.metadata = {};\n  }\n  /**\n   * Load data from the location specified\n   */\n  readLocation(basePath = \"\") {\n    // @todo read location and return contents of it\n    //    if (file_exists(basePath + this.location)) {\n    //      return file_get_contents(basePath + this.location);\n    //    }\n    return FALSE;\n  }\n  /**\n   * Load data from the location specified\n   */\n  writeLocation(body, basePath = \"\") {\n    //    if (file_exists(basePath + this.location)) {\n    //      return file_put_contents(basePath + this.location, body);\n    //    }\n    return FALSE;\n  }\n  /**\n   * Generate a UUID\n   */\n  generateUUID() {\n    return \"ss-s-s-s-sss\".replace(/s/g, this._uuidPart);\n  }\n  _uuidPart() {\n    return Math.floor((1 + Math.random()) * 0x10000)\n      .toString(16)\n      .substring(1);\n  }\n}\nexport { JSONOutlineSchemaItem };\n","/**\n * Copyright 2019 The Pennsylvania State University\n * @license Apache-2.0, see License.md for full text.\n */\nimport { JSONOutlineSchemaItem } from \"./lib/json-outline-schema-item.js\";\n// register globally so we can make sure there is only one\nwindow.JSONOutlineSchema = window.JSONOutlineSchema || {};\n// request if this exists. This helps invoke the element existing in the dom\n// as well as that there is only one of them. That way we can ensure everything\n// is rendered through the same json-outline-schema element, making it a singleton.\nwindow.JSONOutlineSchema.requestAvailability = () => {\n  // if there is no single instance, generate one and append it to end of the document\n  if (!window.JSONOutlineSchema.instance) {\n    window.JSONOutlineSchema.instance = document.createElement(\n      \"json-outline-schema\"\n    );\n    document.body.appendChild(window.JSONOutlineSchema.instance);\n  }\n  return window.JSONOutlineSchema.instance;\n};\n/**\n * `json-outline-schema`\n * `JS based state management helper for the json outline schema spec`\n *\n * @microcopy - language worth noting:\n *  -\n *\n * @customElement\n * @demo demo/index.html\n */\n\nclass JsonOutlineSchema extends HTMLElement {\n  \n  // render function\n  get html() {\n    return `\n<style>:host {\n  display: block;\n  font-family: monospace;\n  white-space: pre;\n  margin: 1em 0px;\n}\n\n:host([hidden]) {\n  display: none;\n}\n</style>\n<slot></slot>`;\n  }\n\n  // properties available to the custom element for data binding\n  static get properties() {\n    return {}\n;\n  }\n\n  /**\n   * Store the tag name to make it easier to obtain directly.\n   * @notice function name must be here for tooling to operate correctly\n   */\n  static get tag() {\n    return \"json-outline-schema\";\n  }\n  /**\n   * life cycle\n   */\n  constructor(delayRender = false) {\n    super();\n    // set tag for later use\n    this.tag = JsonOutlineSchema.tag;\n    // optional queue for future use\n    this._queue = [];\n    this.template = document.createElement(\"template\");\n\n    this.attachShadow({ mode: \"open\" });\n\n    if (!delayRender) {\n      this.render();\n    }\n    this.tag = JsonOutlineSchema.tag;\n    this.file = null;\n    this.id = this.generateUUID();\n    this.title = \"New site\";\n    this.author = \"\";\n    this.description = \"\";\n    this.license = \"by-sa\";\n    this.metadata = {};\n    this.items = [];\n    this.__debug = false;\n    window.JSONOutlineSchema.instance = this;\n  }\n  /**\n   * life cycle, element is afixed to the DOM\n   */\n  connectedCallback() {\n    if (window.ShadyCSS) {\n      window.ShadyCSS.styleElement(this);\n    }\n\n    if (this._queue.length) {\n      this._processQueue();\n    }\n    window.addEventListener(\n      \"json-outline-schema-debug-toggle\",\n      this._toggleDebug.bind(this)\n    );\n    const evt = new CustomEvent(\"json-outline-schema-ready\", {\n      bubbles: true,\n      cancelable: false,\n      detail: true\n    });\n    this.dispatchEvent(evt);\n  }\n\n  _copyAttribute(name, to) {\n    const recipients = this.shadowRoot.querySelectorAll(to);\n    const value = this.getAttribute(name);\n    const fname = value == null ? \"removeAttribute\" : \"setAttribute\";\n    for (const node of recipients) {\n      node[fname](name, value);\n    }\n  }\n\n  _queueAction(action) {\n    this._queue.push(action);\n  }\n\n  _processQueue() {\n    this._queue.forEach(action => {\n      this[`_${action.type}`](action.data);\n    });\n\n    this._queue = [];\n  }\n\n  _setProperty({ name, value }) {\n    this[name] = value;\n  }\n\n  render() {\n    this.shadowRoot.innerHTML = null;\n    this.template.innerHTML = this.html;\n\n    if (window.ShadyCSS) {\n      window.ShadyCSS.prepareTemplate(this.template, this.tag);\n    }\n    this.shadowRoot.appendChild(this.template.content.cloneNode(true));\n  }\n  /**\n   * life cycle, element is removed from the DOM\n   */\n  disconnectedCallback() {\n    window.removeEventListener(\n      \"json-outline-schema-debug-toggle\",\n      this._toggleDebug.bind(this)\n    );\n    const evt = new CustomEvent(\"json-outline-schema-unready\", {\n      bubbles: true,\n      cancelable: false,\n      detail: true\n    });\n    this.dispatchEvent(evt);\n  }\n  /**\n   * Get a new item matching schema standards\n   * @return new JSONOutlineSchemaItem Object\n   */\n  newItem() {\n    return new JSONOutlineSchemaItem();\n  }\n  /**\n   * Add an item to the outline\n   * @var item an array of values, keyed to match JSON Outline Schema\n   * @return count of items in the array\n   */\n  addItem(item) {\n    let safeItem = this.validateItem(item);\n    count = array_push(this.items, safeItem);\n    return count;\n  }\n  /**\n   * Validate that an item matches JSONOutlineSchemaItem format\n   * @var item JSONOutlineSchemaItem\n   * @return JSONOutlineSchemaItem matching the specification\n   */\n  validateItem(item) {\n    // create a generic schema item\n    let tmp = new JSONOutlineSchemaItem();\n    for (var key in tmp) {\n      // only set what the element from spec allows into a new object\n      if (typeof item[key] !== typeof undefined) {\n        tmp[key] = item[key];\n      }\n    }\n    return tmp;\n  }\n  /**\n   * Remove an item from the outline if it exists\n   * @var id an id that's in the array of items\n   * @return JSONOutlineSchemaItem or false if not found\n   */\n  removeItem(id) {\n    for (var key in this.items) {\n      if (this.items[key].id == id) {\n        let tmp = this.items[key];\n        delete this.items[key];\n        return tmp;\n      }\n    }\n    return false;\n  }\n  /**\n   * Remove an item from the outline if it exists\n   * @var id an id that's in the array of items\n   * @return JSONOutlineSchemaItem or false if not found\n   */\n  updateItem(item, save = false) {\n    // verify this is a legit item\n    let safeItem = this.validateItem(item);\n    for (var key in this.items) {\n      // match the current item's ID to our safeItem passed in\n      if (this.items[key].id == safeItem.id) {\n        // overwrite the item\n        this.items[key] = safeItem;\n        // if we save, then we let that return the whole file\n        if (save) {\n          return this.save();\n        }\n        // this was successful\n        return true;\n      }\n    }\n    // we didn't find a match on the ID to bother saving an update\n    return false;\n  }\n  /**\n   * Load a schema from a file\n   */\n  load(location) {\n    if (file_exists(location)) {\n      this.file = location;\n      let fileData = json_decode(file_get_contents(location));\n      for (var key in fileData) {\n        if (typeof this[key] !== typeof undefined && key !== \"items\") {\n          this[key] = fileData[key];\n        }\n      }\n      // check for items and escalate to full JSONOutlineSchemaItem object\n      // also ensures data matches only what is supported\n      if (isset(fileData.items)) {\n        for (var key in fileData.items) {\n          let newItem = new JSONOutlineSchemaItem();\n          newItem.id = item.id;\n          newItem.indent = item.indent;\n          newItem.location = item.location;\n          newItem.order = item.order;\n          newItem.parent = item.parent;\n          newItem.title = item.title;\n          newItem.description = item.description;\n          // metadata can be anything so whatever\n          newItem.metadata = item.metadata;\n          this.items[key] = newItem;\n        }\n      }\n      return true;\n    }\n    return false;\n  }\n  /**\n   * Save data back to the file system location\n   */\n  save() {\n    let schema = {\n      id: this.id,\n      title: this.title,\n      author: this.author,\n      description: this.description,\n      license: this.license,\n      metadata: this.metadata,\n      items: this.items\n    };\n    // @todo write contents\n    //return @file_put_contents(this.file, JSON.stringify(schema, null, 2));\n    return JSON.stringify(schema, null, 2);\n  }\n  /**\n   * Generate a UUID\n   */\n  generateUUID() {\n    return \"ss-s-s-s-sss\".replace(/s/g, this._uuidPart);\n  }\n  _uuidPart() {\n    return Math.floor((1 + Math.random()) * 0x10000)\n      .toString(16)\n      .substring(1);\n  }\n  /**\n   * Allow toggling of debug mode which visualizes the outline and writes it to console.\n   */\n  _toggleDebug(e) {\n    this.__debug = !this.__debug;\n    this._triggerDebugPaint(this.__debug);\n  }\n  /**\n   * Paint the slot in order to debug the object inside\n   */\n  _triggerDebugPaint(debug) {\n    if (debug) {\n      let obj = {\n        file: this.file,\n        id: this.id,\n        title: this.title,\n        author: this.author,\n        description: this.description,\n        license: this.license,\n        metadata: this.metadata,\n        items: this.items\n      };\n      let span = document.createElement(\"span\");\n      span.innerHTML = JSON.stringify(obj, null, 2);\n      this.shadowRoot.appendChild(span.cloneNode(true));\n    } else {\n      this.render();\n    }\n  }\n  static get observedAttributes() {\n    return [\n      \"file\",\n      \"id\",\n      \"title\",\n      \"author\",\n      \"description\",\n      \"license\",\n      \"metadata\"\n    ];\n  }\n\n  attributeChangedCallback(attr, oldValue, newValue) {\n    if (this.__debug) {\n      this.render();\n      this._triggerDebugPaint(this.__debug);\n    }\n  }\n  get file() {\n    return this.getAttribute(\"file\");\n  }\n  set file(newValue) {\n    this.setAttribute(\"file\", newValue);\n  }\n  get id() {\n    return this.getAttribute(\"id\");\n  }\n  set id(newValue) {\n    this.setAttribute(\"id\", newValue);\n  }\n  get title() {\n    return this.getAttribute(\"title\");\n  }\n  set title(newValue) {\n    this.setAttribute(\"title\", newValue);\n  }\n  get author() {\n    return this.getAttribute(\"author\");\n  }\n  set author(newValue) {\n    this.setAttribute(\"author\", newValue);\n  }\n  get description() {\n    return this.getAttribute(\"description\");\n  }\n  set description(newValue) {\n    this.setAttribute(\"description\", newValue);\n  }\n  get license() {\n    return this.getAttribute(\"license\");\n  }\n  set license(newValue) {\n    this.setAttribute(\"license\", newValue);\n  }\n  get metadata() {\n    console.log(JSON.parse(this.getAttribute(\"metadata\")));\n    return JSON.parse(this.getAttribute(\"metadata\"));\n  }\n  set metadata(newValue) {\n    this.setAttribute(\"metadata\", JSON.stringify(newValue));\n  }\n  updateMetadata(key, value) {\n    this.metadata[key] = value;\n  }\n}\nwindow.customElements.define(JsonOutlineSchema.tag, JsonOutlineSchema);\nexport { JsonOutlineSchema };\n"],"names":["JSONOutlineSchemaItem","id","this","generateUUID","ident","location","order","parent","title","description","metadata","FALSE","body","replace","_uuidPart","Math","floor","random","toString","substring","window","JSONOutlineSchema","requestAvailability","instance","document","createElement","appendChild","JsonOutlineSchema","delayRender","tag","_queue","template","attachShadow","mode","render","file","_this","author","license","items","__debug","HTMLElement","ShadyCSS","styleElement","length","_processQueue","addEventListener","_toggleDebug","bind","evt","CustomEvent","bubbles","cancelable","detail","dispatchEvent","name","to","recipients","shadowRoot","querySelectorAll","value","getAttribute","fname","action","push","forEach","_this2","type","data","innerHTML","html","prepareTemplate","content","cloneNode","removeEventListener","item","safeItem","validateItem","count","array_push","tmp","key","_typeof","save","file_exists","fileData","json_decode","file_get_contents","isset","newItem","indent","schema","JSON","stringify","e","_triggerDebugPaint","debug","obj","span","attr","oldValue","newValue","setAttribute","console","log","parse","customElements","define"],"mappings":"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"}