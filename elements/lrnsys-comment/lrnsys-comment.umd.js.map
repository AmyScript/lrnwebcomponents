{"version":3,"file":"lrnsys-comment.umd.js","sources":["lrnsys-comment.umd.js"],"sourcesContent":["import { html, Polymer } from \"@polymer/polymer/polymer-legacy.js\";\nimport { dom } from \"@polymer/polymer/lib/legacy/polymer.dom.js\";\nimport \"@polymer/iron-icons/editor-icons.js\";\nimport \"@polymer/marked-element/marked-element.js\";\nimport \"@polymer/paper-tooltip/paper-tooltip.js\";\nimport \"@polymer/paper-card/paper-card.js\";\nimport \"@polymer/paper-badge/paper-badge.js\";\nimport \"@lrnwebcomponents/moment-element/moment-element.js\";\nimport \"@lrnwebcomponents/materializecss-styles/lib/colors.js\";\nimport \"@lrnwebcomponents/mtz-marked-editor/mtz-marked-editor.js\";\nimport \"@lrnwebcomponents/mtz-marked-editor/lib/mtz-marked-control-generic-line.js\";\nimport \"@lrnwebcomponents/mtz-marked-editor/lib/mtz-marked-control-generic-wrap.js\";\nimport \"@lrnwebcomponents/mtz-marked-editor/lib/controls/mtz-marked-control-link.js\";\nimport \"@lrnwebcomponents/word-count/word-count.js\";\nimport \"@lrnwebcomponents/lrnsys-button/lrnsys-button.js\";\nimport \"@lrnwebcomponents/lrndesign-avatar/lrndesign-avatar.js\";\n/**\n`lrnsys-comment`\nA well styled comment for a user with markdown support.\n\n@demo demo/index.html\n*/\nPolymer({\n  _template: html`\n    <style include=\"materializecss-styles-colors\">\n      :host {\n        display: block;\n        padding: 10px 10px 10px 0px;\n      }\n      :host[disabled] {\n        opacity: .5;\n        background-color: #cccccc;\n        pointer-events: none;\n      }\n      :host:focus,\n      :host:hover {\n        z-index: 2;\n      }\n      :host:focus .comment-outer,\n      :host:hover .comment-outer {\n        border: 1px #0277bd solid;\n      }\n      .comment-outer {\n        display: table;\n        width: 100%;\n        border: 1px #ddd solid;\n        color: #444;\n      }\n      .comment-outer.new-comment {\n        border: 1px #d81b60 dashed;\n        color: #000;\n      }\n      .comment-inner {\n        display: table-row;\n      }\n      .comment-avatar {\n        padding: 0 7px;\n        width: 40px;\n      }\n      .comment-depth,\n      .comment-avatar, \n      .comment-content {\n        padding-top: 0.5em;\n        padding-bottom: 0.5em;\n        display: table-cell;\n        vertical-align: top;\n      }\n      .comment-content {\n        padding-right: 7px;\n      }\n      h1,\n      h2,\n      h3,\n      h4 {\n        text-align: left;\n        font-size: 1rem;\n        line-height: 1.25rem;\n      }\n      h1.comment-heading,\n      h2.comment-heading,\n      h3.comment-heading,\n      h4.comment-heading {\n        margin-top: 7px;\n      }\n      p {\n        font-size: 14px;\n        line-height: 18px;\n        text-align: left;\n      }\n      #edit-comment {\n        background-color: white;\n        padding: .25em;\n      }\n      marked-element {\n        line-height: 1rem;\n        font-size: 0.9rem;\n      }\n      .nowrap-me marked-element:hover {\n        box-shadow: -1px 0 0 0 black inset;\n        cursor: pointer;\n      }\n      .nowrap-me marked-element ::slotted(#content p.marked-element) {\n        height: 2em;\n        overflow: hidden;\n        text-overflow: ellipsis;\n        margin-bottom: 35px;\n      }\n      .nowrap-me marked-element ::slotted(#content p.marked-element::after) {\n        content: \"see more\";\n        position: absolute;\n        bottom: 65px;\n        right: 17px;\n        color: #1976d2;\n      }\n      .comment-depth-1 {\n        width: 0em;\n      }\n      .comment-depth-2 {\n        width: 54px;\n        border-right: 3px solid #ccc;\n      }\n      .comment-depth-3,\n      .comment-depth-4,\n      .comment-depth-5,\n      .comment-depth-6,\n      .comment-depth-7,\n      .comment-depth-8,\n      .comment-depth-9 {\n        width: 108px;\n        border-right: 3px solid #ccc;\n      }\n      .center {\n        padding: 0;\n      }\n      .circle {\n        border-radius: 50% !important;\n      }\n      .comment-actions {\n        margin: 0;\n        padding: 0;\n        display: block;\n        border-top: 1px solid #ddd;\n      }\n      .comment-actions lrnsys-button {\n        display: inline-flex;\n      }\n      .comment-actions .comment-actions-group {\n        margin: 0;\n        padding: 0;\n        display: block;\n      }\n      .comment-actions .comment-actions-group.left-actions {\n        float: left;\n      }\n      .comment-actions .comment-actions-group.right-actions {\n        float: right;\n      }\n      moment-element {\n        float: right;\n        font-size: 90%;\n        font-style: italic;\n        font-weight: normal;\n      }\n      paper-badge {\n        right: 0px;\n        top: 0px;\n      }\n      .like-icon-color {\n        color: #2196F3;\n      }\n      .element-invisible {\n        position: absolute;\n        left: -9999px;\n        top: 0;\n        width: 0;\n        height: 0;\n        overflow: hidden;\n      }\n    </style>\n    <div class\\$=\"comment-outer [[commentNew]]\">\n      <div class=\"comment-inner\">\n        <div class\\$=\"comment-depth comment-depth-[[comment.attributes.threadDepth]] grey lighten-3\"></div>\n        <div class=\"comment-avatar\">\n          <lrndesign-avatar id=\"avatar\" label=\"[[comment.relationships.author.data.name]]\" src=\"[[comment.relationships.author.data.avatar]]\" class=\"float-left ferpa-protect\"></lrndesign-avatar>\n          <paper-tooltip for=\"avatar\" animation-delay=\"0\" class=\"ferpa-protect\">[[displayName]]</paper-tooltip>\n        </div>\n        <div class=\"comment-content\">\n          <div class=\"comment-body\">\n            <div id=\"bodyarea\" class=\"nowrap-me\">\n              <h4 class=\"ferpa-protect comment-heading\">\n                <span class=\"element-invisible\">At </span><moment-element datetime\\$=\"[[comment.attributes.created]]\" output-format=\"MMM DD[,] YYYY\"></moment-element>\n                [[comment.relationships.author.data.display_name]] <span class=\"element-invisible\">[[comment.relationships.author.data.visual.label]]</span> said:\n              </h4>\n              <marked-element smartypants=\"\" id=\"rendered-comment\" markdown=\"[[comment.attributes.body]]\">\n                <word-count class=\"markdown-html-slot\" slot=\"markdown-html\"></word-count>\n              </marked-element>\n            </div>\n            <mtz-marked-editor id=\"comment-editor\" hidden=\"\">\n              <div slot=\"controls\">\n                <mtz-marked-control-generic-wrap icon=\"editor:format-bold\" title=\"Bold\" syntax-prefix=\"**\" syntax-suffix=\"**\" keys=\"ctrl+b\"></mtz-marked-control-generic-wrap>\n                <mtz-marked-control-generic-wrap icon=\"editor:format-italic\" title=\"Italic\" syntax-prefix=\"_\" syntax-suffix=\"_\" keys=\"ctrl+i\"></mtz-marked-control-generic-wrap>\n                <mtz-marked-control-generic-line icon=\"editor:format-size\" title=\"Heading 3\" syntax-prefix=\"### \"></mtz-marked-control-generic-line>\n                <mtz-marked-control-generic-line icon=\"editor:format-list-numbered\" title=\"Ordered List\" syntax-prefix=\"1. \"></mtz-marked-control-generic-line>\n                <mtz-marked-control-generic-line icon=\"editor:format-list-bulleted\" title=\"Unordered List\" syntax-prefix=\"- \"></mtz-marked-control-generic-line>\n                <mtz-marked-control-link icon=\"editor:insert-link\" title=\"Link\"></mtz-marked-control-link>\n              </div>\n              <paper-textarea char-counter=\"\" autofocus=\"\" id=\"edit-comment\" label=\"Comment\" value=\"{{comment.attributes.body}}\" slot=\"textarea\"></paper-textarea>\n            </mtz-marked-editor>\n          </div>\n          <div class=\"comment-actions\">\n            <div class=\"comment-actions-group left-actions\">\n              <lrnsys-button on-click=\"actionHandler\" id=\"reply\" data-commentid=\"[[comment.id]]\" alt=\"Reply\" icon=\"reply\" hover-class=\"[[hoverClass]]\" icon-class=\"grey-text no-margin\" hidden\\$=\"[[!comment.actions.reply]]\"></lrnsys-button>\n              <lrnsys-button on-click=\"actionHandler\" id=\"like\" data-commentid=\"[[comment.id]]\" alt=\"Like\" icon=\"thumb-up\" hover-class=\"[[hoverClass]]\" icon-class=\"grey-text no-margin\" hidden\\$=\"[[!comment.actions.like]]\"></lrnsys-button>\n            </div>\n            <div class=\"comment-actions-group right-actions\">\n              <lrnsys-button on-click=\"actionHandler\" id=\"edit\" data-commentid=\"[[comment.id]]\" icon=\"create\" alt=\"Edit\" hover-class=\"[[hoverClass]]\" icon-class=\"grey-text no-margin\" hidden\\$=\"[[!comment.actions.edit]]\"></lrnsys-button>\n              <lrnsys-button on-click=\"actionHandler\" id=\"delete\" data-commentid=\"[[comment.id]]\" icon=\"delete-forever\" alt=\"Delete\" hover-class=\"[[hoverClass]]\" icon-class=\"grey-text no-margin\" hidden\\$=\"[[!comment.actions.delete]]\"></lrnsys-button>\n            </div>\n          </div>\n        </div>\n      </div>\n    </div>\n    <template is=\"dom-if\" if=\"[[comment.relationships.author.data.visual.icon]]\">\n      <paper-badge icon=\"[[comment.relationships.author.data.visual.icon]]\" for=\"papercard\" label=\"[[comment.relationships.author.data.visual.label]]\">\n      </paper-badge>\n    </template>\n`,\n\n  is: \"lrnsys-comment\",\n\n  listeners: {\n    \"bodyarea.tap\": \"bodyToggle\",\n    \"bodyarea.dblclick\": \"bodyToggleOn\"\n  },\n\n  properties: {\n    comment: {\n      type: Object,\n      notify: true,\n      observer: \"_commentLoaded\"\n    },\n    displayName: {\n      type: String,\n      notify: true,\n      computed:\n        \"_generateName(comment.relationships.author.data.display_name, comment.relationships.author.data.visual)\"\n    },\n    commentNew: {\n      type: String,\n      notify: true,\n      computed: \"_isCommentNew(comment.relationships.author.data.visual)\"\n    },\n    hoverClass: {\n      type: String,\n      reflectToAttribute: true\n    },\n    editform: {\n      type: Boolean,\n      notify: true,\n      observer: \"_editTrigger\",\n      reflectToAttribute: true\n    },\n    disabled: {\n      type: Boolean,\n      notify: true,\n      reflectToAttribute: true\n    }\n  },\n\n  _generateName: function(name, visual) {\n    if (typeof visual !== typeof undefined && visual.label !== false) {\n      return name + \" (\" + visual.label + \")\";\n    }\n    return name;\n  },\n\n  _isCommentNew: function(visual) {\n    if (typeof visual !== typeof undefined && visual.label !== false) {\n      return \"new-comment\";\n    }\n    return \"\";\n  },\n\n  _commentLoaded: function(e) {\n    let root = this;\n    root.editform = root.comment.metadata.editing;\n    root.disabled = root.comment.metadata.disabled;\n    root.blockFirstState = true;\n  },\n\n  /**\n   * Handle all actions from the button bar.\n   */\n  actionHandler: function(e) {\n    let root = this;\n    // convert click handler into local dom object\n    var normalizedEvent = dom(e);\n    var target = normalizedEvent.localTarget;\n    var comment = null;\n    // ensure we have a comment ID to operate against\n    if (target.dataCommentid != null && !target.disabled) {\n      comment = target.dataCommentid;\n      // handle the type of event requested\n      if (target.id == \"reply\") {\n        root.fire(\"comment-reply\", { comment: root.comment });\n      } else if (target.id == \"like\") {\n        root.shadowRoot\n          .querySelector(\"#like\")\n          .classList.toggle(\"like-icon-color\");\n        root.fire(\"comment-like\", { comment: root.comment });\n      } else if (target.id == \"edit\") {\n        // toggle edit, allow edit state handle itself via observer\n        root.editform = !root.editform;\n      } else if (target.id == \"delete\") {\n        root.fire(\"comment-delete-dialog\", { comment: root.comment });\n      }\n    }\n  },\n\n  /**\n   * Trigger the edit form.\n   */\n  _editTrigger: function(e) {\n    let root = this;\n    // bother checking if they can edit or not first\n    if (typeof root.comment !== typeof undefined && root.comment.actions.edit) {\n      root.async(function() {\n        // show / hide the edit vs display area\n        root.shadowRoot.querySelector(\"#rendered-comment\").hidden =\n          root.editform;\n        root.shadowRoot.querySelector(\n          \"#comment-editor\"\n        ).hidden = !root.editform;\n        // simple icon toggle\n        if (root.editform) {\n          root.shadowRoot.querySelector(\"#edit\").icon = \"save\";\n          root.shadowRoot.querySelector(\"#edit\").alt = \"Save\";\n          root.shadowRoot.querySelector(\"#reply\").disabled = true;\n          root.shadowRoot.querySelector(\"#edit-comment\").focus();\n          root.fire(\"comment-editing\", { comment: root.comment });\n          root.blockFirstState = false;\n        } else {\n          if (!root.blockFirstState) {\n            root.fire(\"comment-save\", { comment: root.comment });\n          } else {\n            root.blockFirstState = false;\n          }\n          root.shadowRoot.querySelector(\"#edit\").icon = \"create\";\n          root.shadowRoot.querySelector(\"#edit\").alt = \"Edit\";\n          root.shadowRoot.querySelector(\"#reply\").disabled = false;\n        }\n        document.querySelector(\"iron-list\").fire(\"iron-resize\");\n        // access sibling or parent elements here\n      });\n    }\n  },\n\n  /**\n   * Toggle the body field expanding to show the whole comment\n   */\n  bodyToggle: function(e) {\n    let root = this;\n    root.$.bodyarea.classList.remove(\"nowrap-me\");\n    document.querySelector(\"iron-list\").fire(\"iron-resize\");\n  },\n\n  /**\n   * Toggle the body field expanding to show the whole comment\n   */\n  bodyToggleOn: function(e) {\n    let root = this;\n    root.$.bodyarea.classList.toggle(\"nowrap-me\");\n    document.querySelector(\"iron-list\").fire(\"iron-resize\");\n  }\n});\n"],"names":["_template","html","is","listeners","properties","comment","type","Object","notify","observer","displayName","String","computed","commentNew","hoverClass","reflectToAttribute","editform","Boolean","disabled","_generateName","name","visual","_typeof","label","_isCommentNew","_commentLoaded","e","this","metadata","editing","blockFirstState","actionHandler","target","dom","localTarget","dataCommentid","id","fire","shadowRoot","querySelector","classList","toggle","_editTrigger","root","actions","edit","async","hidden","icon","alt","focus","document","bodyToggle","$","bodyarea","remove","bodyToggleOn"],"mappings":"0ojBAsBQ,CACNA,UAAWC,YA6MXC,GAAI,iBAEJC,UAAW,gBACO,iCACK,gBAGvBC,WAAY,CACVC,QAAS,CACPC,KAAMC,OACNC,QAAQ,EACRC,SAAU,kBAEZC,YAAa,CACXJ,KAAMK,OACNH,QAAQ,EACRI,SACE,2GAEJC,WAAY,CACVP,KAAMK,OACNH,QAAQ,EACRI,SAAU,2DAEZE,WAAY,CACVR,KAAMK,OACNI,oBAAoB,GAEtBC,SAAU,CACRV,KAAMW,QACNT,QAAQ,EACRC,SAAU,eACVM,oBAAoB,GAEtBG,SAAU,CACRZ,KAAMW,QACNT,QAAQ,EACRO,oBAAoB,IAIxBI,cAAe,SAASC,EAAMC,uBACxBC,EAAOD,KAAgD,IAAjBA,EAAOE,MACxCH,EAAO,KAAOC,EAAOE,MAAQ,IAE/BH,GAGTI,cAAe,SAASH,uBAClBC,EAAOD,KAAgD,IAAjBA,EAAOE,MACxC,cAEF,IAGTE,eAAgB,SAASC,GACZC,KACNX,SADMW,KACUtB,QAAQuB,SAASC,QAD3BF,KAENT,SAFMS,KAEUtB,QAAQuB,SAASV,SAF3BS,KAGNG,iBAAkB,GAMzBC,cAAe,SAASL,OAIlBM,EADkBC,MAAIP,GACGQ,YAGD,MAAxBF,EAAOG,eAA0BH,EAAOd,WAChCc,EAAOG,cAEA,SAAbH,EAAOI,GATFT,KAUFU,KAAK,gBAAiB,CAAEhC,QAVtBsB,KAUoCtB,UACrB,QAAb2B,EAAOI,IAXTT,KAYFW,WACFC,cAAc,SACdC,UAAUC,OAAO,mBAdbd,KAeFU,KAAK,eAAgB,CAAEhC,QAfrBsB,KAemCtB,WACpB,QAAb2B,EAAOI,GAhBTT,KAkBFX,UAlBEW,KAkBeX,SACA,UAAbgB,EAAOI,IAnBTT,KAoBFU,KAAK,wBAAyB,CAAEhC,QApB9BsB,KAoB4CtB,YAQzDqC,aAAc,SAAShB,OACjBiB,EAAOhB,mBAEPL,EAAOqB,EAAKtC,UAAgCsC,EAAKtC,QAAQuC,QAAQC,MACnEF,EAAKG,MAAM,WAETH,EAAKL,WAAWC,cAAc,qBAAqBQ,OACjDJ,EAAK3B,SACP2B,EAAKL,WAAWC,cACd,mBACAQ,QAAUJ,EAAK3B,SAEb2B,EAAK3B,UACP2B,EAAKL,WAAWC,cAAc,SAASS,KAAO,OAC9CL,EAAKL,WAAWC,cAAc,SAASU,IAAM,OAC7CN,EAAKL,WAAWC,cAAc,UAAUrB,UAAW,EACnDyB,EAAKL,WAAWC,cAAc,iBAAiBW,QAC/CP,EAAKN,KAAK,kBAAmB,CAAEhC,QAASsC,EAAKtC,UAC7CsC,EAAKb,iBAAkB,IAElBa,EAAKb,gBAGRa,EAAKb,iBAAkB,EAFvBa,EAAKN,KAAK,eAAgB,CAAEhC,QAASsC,EAAKtC,UAI5CsC,EAAKL,WAAWC,cAAc,SAASS,KAAO,SAC9CL,EAAKL,WAAWC,cAAc,SAASU,IAAM,OAC7CN,EAAKL,WAAWC,cAAc,UAAUrB,UAAW,GAErDiC,SAASZ,cAAc,aAAaF,KAAK,kBAS/Ce,WAAY,SAAS1B,GACRC,KACN0B,EAAEC,SAASd,UAAUe,OAAO,aACjCJ,SAASZ,cAAc,aAAaF,KAAK,gBAM3CmB,aAAc,SAAS9B,GACVC,KACN0B,EAAEC,SAASd,UAAUC,OAAO,aACjCU,SAASZ,cAAc,aAAaF,KAAK"}