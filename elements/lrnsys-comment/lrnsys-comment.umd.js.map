{"version":3,"file":"lrnsys-comment.umd.js","sources":["lrnsys-comment.umd.js"],"sourcesContent":["/**\n * Copyright 2018 The Pennsylvania State University\n * @license Apache-2.0, see License.md for full text.\n */\nimport { html, Polymer } from \"@polymer/polymer/polymer-legacy.js\";\nimport { dom } from \"@polymer/polymer/lib/legacy/polymer.dom.js\";\nimport * as async from \"@polymer/polymer/lib/utils/async.js\";\nimport \"@polymer/iron-icons/editor-icons.js\";\nimport \"@polymer/marked-element/marked-element.js\";\nimport \"@polymer/paper-tooltip/paper-tooltip.js\";\nimport \"@polymer/paper-card/paper-card.js\";\nimport \"@polymer/paper-input/paper-textarea.js\";\nimport \"@polymer/paper-badge/paper-badge.js\";\nimport \"@lrnwebcomponents/moment-element/moment-element.js\";\nimport \"@lrnwebcomponents/materializecss-styles/lib/colors.js\";\nimport \"@lrnwebcomponents/mtz-marked-editor/mtz-marked-editor.js\";\nimport \"@lrnwebcomponents/mtz-marked-editor/lib/mtz-marked-control-generic-line.js\";\nimport \"@lrnwebcomponents/mtz-marked-editor/lib/mtz-marked-control-generic-wrap.js\";\nimport \"@lrnwebcomponents/mtz-marked-editor/lib/mtz-marked-control-link.js\";\nimport \"@lrnwebcomponents/word-count/word-count.js\";\nimport \"@lrnwebcomponents/lrnsys-button/lrnsys-button.js\";\nimport \"@lrnwebcomponents/lrndesign-avatar/lrndesign-avatar.js\";\n/**\n`lrnsys-comment`\nA well styled comment for a user with markdown support.\n\n@demo demo/index.html\n*/\nlet LrnsysComment = Polymer({\n  _template: html`\n    <style include=\"materializecss-styles-colors\">\n      :host {\n        display: block;\n        padding: 10px 10px 10px 0px;\n      }\n      :host([disabled]) {\n        opacity: .5;\n        background-color: #cccccc;\n        pointer-events: none;\n      }\n      :host(:focus),\n      :host(:hover) {\n        z-index: 2;\n      }\n      :host(:focus) .comment-outer,\n      :host(:hover) .comment-outer {\n        border: 1px #0277bd solid;\n      }\n      :host [hidden] {\n        display: none;\n      }\n      .comment-outer {\n        display: table;\n        width: 100%;\n        border: 1px #ddd solid;\n        color: #444;\n      }\n      .comment-outer.new-comment {\n        border: 1px #d81b60 dashed;\n        color: #000;\n      }\n      .comment-inner {\n        display: table-row;\n      }\n      .comment-avatar {\n        padding: 0 7px;\n        width: 40px;\n      }\n      .comment-depth,\n      .comment-avatar,\n      .comment-content {\n        padding-top: 8px;\n        padding-bottom: 8px;\n        display: table-cell;\n        vertical-align: top;\n      }\n      .comment-content {\n        padding-right: 7px;\n      }\n      h1,\n      h2,\n      h3,\n      h4 {\n        text-align: left;\n        font-size: 20px;\n        line-height: 20px;\n      }\n      h1.comment-heading,\n      h2.comment-heading,\n      h3.comment-heading,\n      h4.comment-heading {\n        margin-top: 7px;\n      }\n      p {\n        font-size: 14px;\n        line-height: 18px;\n        text-align: left;\n      }\n      #editcomment {\n        background-color: white;\n        padding: 4px;\n      }\n      marked-element {\n        line-height: 16px;\n        font-size: 14.4px;\n      }\n      .nowrap-me marked-element:hover {\n        box-shadow: -1px 0 0 0 black inset;\n        cursor: pointer;\n      }\n      .nowrap-me marked-element ::slotted(#content p.marked-element) {\n        height: 32px;\n        overflow: hidden;\n        text-overflow: ellipsis;\n        margin-bottom: 35px;\n      }\n      .nowrap-me marked-element ::slotted(#content p.marked-element:after) {\n        content: \"see more\";\n        position: absolute;\n        bottom: 65px;\n        right: 17px;\n        color: #1976d2;\n      }\n      .comment-depth-1 {\n        width: 0;\n      }\n      .comment-depth-2 {\n        width: 54px;\n        border-right: 3px solid #ccc;\n      }\n      .comment-depth-3,\n      .comment-depth-4,\n      .comment-depth-5,\n      .comment-depth-6,\n      .comment-depth-7,\n      .comment-depth-8,\n      .comment-depth-9 {\n        width: 108px;\n        border-right: 3px solid #ccc;\n      }\n      .center {\n        padding: 0;\n      }\n      .circle {\n        border-radius: 50% !important;\n      }\n      .comment-actions {\n        margin: 0;\n        padding: 0;\n        display: block;\n        border-top: 1px solid #ddd;\n      }\n      .comment-actions lrnsys-button {\n        display: inline-flex;\n      }\n      .comment-actions .comment-actions-group {\n        margin: 0;\n        padding: 0;\n        display: block;\n      }\n      .comment-actions .comment-actions-group.left-actions {\n        float: left;\n      }\n      .comment-actions .comment-actions-group.right-actions {\n        float: right;\n      }\n      moment-element {\n        float: right;\n        font-size: 90%;\n        font-style: italic;\n        font-weight: normal;\n      }\n      paper-badge {\n        right: 0px;\n        top: 0px;\n      }\n      .like-icon-color {\n        color: #2196F3;\n      }\n      .element-invisible {\n        position: absolute;\n        left: -9999px;\n        top: 0;\n        width: 0;\n        height: 0;\n        overflow: hidden;\n      }\n    </style>\n    <div class\\$=\"comment-outer [[commentNew]]\">\n      <div class=\"comment-inner\">\n        <div class\\$=\"comment-depth comment-depth-[[comment.attributes.threadDepth]] grey lighten-3\"></div>\n        <div class=\"comment-avatar\">\n          <lrndesign-avatar id=\"avatar\" label=\"[[comment.relationships.author.data.name]]\" src=\"[[comment.relationships.author.data.avatar]]\" class=\"float-left ferpa-protect\"></lrndesign-avatar>\n          <paper-tooltip for=\"avatar\" animation-delay=\"0\" class=\"ferpa-protect\">[[displayName]]</paper-tooltip>\n        </div>\n        <div class=\"comment-content\">\n          <div class=\"comment-body\">\n            <div id=\"bodyarea\" class=\"nowrap-me\">\n              <h4 class=\"ferpa-protect comment-heading\">\n                <span class=\"element-invisible\">At </span><moment-element datetime\\$=\"[[comment.attributes.created]]\" output-format=\"MMM DD[,] YYYY\"></moment-element>\n                [[comment.relationships.author.data.display_name]] <span class=\"element-invisible\">[[comment.relationships.author.data.visual.label]]</span> said:\n              </h4>\n              <marked-element smartypants id=\"renderedcomment\" markdown=\"[[comment.attributes.body]]\">\n                <word-count class=\"markdown-html-slot\" slot=\"markdown-html\"></word-count>\n              </marked-element>\n            </div>\n            <mtz-marked-editor id=\"commenteditor\" hidden>\n              <div slot=\"controls\">\n                <mtz-marked-control-generic-wrap icon=\"editor:format-bold\" title=\"Bold\" syntax-prefix=\"**\" syntax-suffix=\"**\" keys=\"ctrl+b\"></mtz-marked-control-generic-wrap>\n                <mtz-marked-control-generic-wrap icon=\"editor:format-italic\" title=\"Italic\" syntax-prefix=\"_\" syntax-suffix=\"_\" keys=\"ctrl+i\"></mtz-marked-control-generic-wrap>\n                <mtz-marked-control-generic-line icon=\"editor:format-size\" title=\"Heading 3\" syntax-prefix=\"### \"></mtz-marked-control-generic-line>\n                <mtz-marked-control-generic-line icon=\"editor:format-list-numbered\" title=\"Ordered List\" syntax-prefix=\"1. \"></mtz-marked-control-generic-line>\n                <mtz-marked-control-generic-line icon=\"editor:format-list-bulleted\" title=\"Unordered List\" syntax-prefix=\"- \"></mtz-marked-control-generic-line>\n                <mtz-marked-control-link icon=\"editor:insert-link\" title=\"Link\"></mtz-marked-control-link>\n              </div>\n              <paper-textarea char-counter autofocus id=\"editcomment\" label=\"Comment\" value=\"{{comment.attributes.body}}\" slot=\"textarea\"></paper-textarea>\n            </mtz-marked-editor>\n          </div>\n          <div class=\"comment-actions\">\n            <div class=\"comment-actions-group left-actions\">\n              <lrnsys-button on-tap=\"actionHandler\" id=\"reply\" data-commentid=\"[[comment.id]]\" alt=\"Reply\" icon=\"reply\" hover-class=\"[[hoverClass]]\" icon-class=\"grey-text no-margin\" hidden\\$=\"[[!comment.actions.reply]]\"></lrnsys-button>\n              <lrnsys-button on-tap=\"actionHandler\" id=\"like\" data-commentid=\"[[comment.id]]\" alt=\"Like\" icon=\"thumb-up\" hover-class=\"[[hoverClass]]\" icon-class=\"grey-text no-margin\" hidden\\$=\"[[!comment.actions.like]]\"></lrnsys-button>\n            </div>\n            <div class=\"comment-actions-group right-actions\">\n              <lrnsys-button on-tap=\"actionHandler\" id=\"edit\" data-commentid=\"[[comment.id]]\" icon=\"create\" alt=\"Edit\" hover-class=\"[[hoverClass]]\" icon-class=\"grey-text no-margin\" hidden\\$=\"[[!comment.actions.edit]]\"></lrnsys-button>\n              <lrnsys-button on-tap=\"actionHandler\" id=\"delete\" data-commentid=\"[[comment.id]]\" icon=\"delete-forever\" alt=\"Delete\" hover-class=\"[[hoverClass]]\" icon-class=\"grey-text no-margin\" hidden\\$=\"[[!comment.actions.delete]]\"></lrnsys-button>\n            </div>\n          </div>\n        </div>\n      </div>\n    </div>\n    <template is=\"dom-if\" if=\"[[comment.relationships.author.data.visual.icon]]\">\n      <paper-badge icon=\"[[comment.relationships.author.data.visual.icon]]\" for=\"papercard\" label=\"[[comment.relationships.author.data.visual.label]]\">\n      </paper-badge>\n    </template>\n`,\n\n  is: \"lrnsys-comment\",\n\n  properties: {\n    comment: {\n      type: Object,\n      notify: true,\n      observer: \"_commentLoaded\"\n    },\n    displayName: {\n      type: String,\n      notify: true,\n      computed:\n        \"_generateName(comment.relationships.author.data.display_name, comment.relationships.author.data.visual)\"\n    },\n    commentNew: {\n      type: String,\n      notify: true,\n      computed: \"_isCommentNew(comment.relationships.author.data.visual)\"\n    },\n    hoverClass: {\n      type: String,\n      reflectToAttribute: true\n    },\n    editform: {\n      type: Boolean,\n      notify: true,\n      observer: \"_editTrigger\",\n      reflectToAttribute: true\n    },\n    disabled: {\n      type: Boolean,\n      notify: true,\n      reflectToAttribute: true\n    }\n  },\n\n  /**\n   * attached lifecycle\n   */\n  attached: function() {\n    this.$.bodyarea.addEventListener(\"tap\", this.bodyToggle.bind(this));\n    this.$.bodyarea.addEventListener(\"dblclick\", this.bodyToggleOn.bind(this));\n  },\n  /**\n   * detached lifecycle\n   */\n  detached: function() {\n    this.$.bodyarea.removeEventListener(\"tap\", this.bodyToggle.bind(this));\n    this.$.bodyarea.removeEventListener(\n      \"dblclick\",\n      this.bodyToggleOn.bind(this)\n    );\n  },\n\n  _generateName: function(name, visual) {\n    if (typeof visual !== typeof undefined && visual.label !== false) {\n      return name + \" (\" + visual.label + \")\";\n    }\n    return name;\n  },\n\n  _isCommentNew: function(visual) {\n    if (typeof visual !== typeof undefined && visual.label !== false) {\n      return \"new-comment\";\n    }\n    return \"\";\n  },\n\n  _commentLoaded: function(e) {\n    this.editform = this.comment.metadata.editing;\n    this.disabled = this.comment.metadata.disabled;\n    this.blockFirstState = true;\n  },\n\n  /**\n   * Handle all actions from the button bar.\n   */\n  actionHandler: function(e) {\n    // convert click handler into local dom object\n    var normalizedEvent = dom(e);\n    var target = normalizedEvent.localTarget;\n    var comment = null;\n    // ensure we have a comment ID to operate against\n    if (target.dataCommentid != null && !target.disabled) {\n      comment = target.dataCommentid;\n      // handle the type of event requested\n      if (target.id == \"reply\") {\n        this.fire(\"comment-reply\", { comment: this.comment, target: target });\n      } else if (target.id == \"like\") {\n        this.$.like.classList.toggle(\"like-icon-color\");\n        this.fire(\"comment-like\", { comment: this.comment, target: target });\n      } else if (target.id == \"edit\") {\n        // toggle edit, allow edit state handle itself via observer\n        this.editform = !this.editform;\n      } else if (target.id == \"delete\") {\n        this.fire(\"comment-delete-dialog\", {\n          comment: this.comment,\n          target: target\n        });\n      }\n    }\n  },\n\n  /**\n   * Trigger the edit form.\n   */\n  _editTrigger: function(e) {\n    // bother checking if they can edit or not first\n    if (typeof this.comment !== typeof undefined && this.comment.actions.edit) {\n      async.microTask.run(() => {\n        // show / hide the edit vs display area\n        this.$.renderedcomment.hidden = this.editform;\n        this.$.commenteditor.hidden = !this.editform;\n        // simple icon toggle\n        if (this.editform) {\n          this.$.edit.icon = \"save\";\n          this.$.edit.alt = \"Save\";\n          this.$.reply.disabled = true;\n          this.$.editcomment.focus();\n          this.fire(\"comment-editing\", { comment: this.comment });\n          this.blockFirstState = false;\n        } else {\n          if (!this.blockFirstState) {\n            this.fire(\"comment-save\", { comment: this.comment });\n          } else {\n            this.blockFirstState = false;\n          }\n          this.$.edit.icon = \"create\";\n          this.$.edit.alt = \"Edit\";\n          this.$.reply.disabled = false;\n        }\n        this.fire(\"iron-resize\");\n      });\n    }\n  },\n  /**\n   * Toggle the body field expanding to show the whole comment\n   */\n  bodyToggle: function(e) {\n    this.$.bodyarea.classList.remove(\"nowrap-me\");\n    this.fire(\"iron-resize\");\n  },\n\n  /**\n   * Toggle the body field expanding to show the whole comment\n   */\n  bodyToggleOn: function(e) {\n    this.$.bodyarea.classList.toggle(\"nowrap-me\");\n    this.fire(\"iron-resize\");\n  }\n});\nexport { LrnsysComment };\n"],"names":["LrnsysComment","Polymer","_template","html","is","properties","comment","type","Object","notify","observer","displayName","String","computed","commentNew","hoverClass","reflectToAttribute","editform","Boolean","disabled","attached","$","bodyarea","addEventListener","this","bodyToggle","bind","bodyToggleOn","detached","removeEventListener","_generateName","name","visual","_typeof","label","_isCommentNew","_commentLoaded","e","metadata","editing","blockFirstState","actionHandler","target","dom","localTarget","dataCommentid","id","fire","like","classList","toggle","_editTrigger","actions","edit","async","run","_this","renderedcomment","hidden","commenteditor","icon","alt","reply","editcomment","focus","remove"],"mappings":"i5jBA4BIA,EAAgBC,UAAQ,CAC1BC,UAAWC,YAgNXC,GAAI,iBAEJC,WAAY,CACVC,QAAS,CACPC,KAAMC,OACNC,QAAQ,EACRC,SAAU,kBAEZC,YAAa,CACXJ,KAAMK,OACNH,QAAQ,EACRI,SACE,2GAEJC,WAAY,CACVP,KAAMK,OACNH,QAAQ,EACRI,SAAU,2DAEZE,WAAY,CACVR,KAAMK,OACNI,oBAAoB,GAEtBC,SAAU,CACRV,KAAMW,QACNT,QAAQ,EACRC,SAAU,eACVM,oBAAoB,GAEtBG,SAAU,CACRZ,KAAMW,QACNT,QAAQ,EACRO,oBAAoB,IAOxBI,SAAU,gBACHC,EAAEC,SAASC,iBAAiB,MAAOC,KAAKC,WAAWC,KAAKF,YACxDH,EAAEC,SAASC,iBAAiB,WAAYC,KAAKG,aAAaD,KAAKF,QAKtEI,SAAU,gBACHP,EAAEC,SAASO,oBAAoB,MAAOL,KAAKC,WAAWC,KAAKF,YAC3DH,EAAEC,SAASO,oBACd,WACAL,KAAKG,aAAaD,KAAKF,QAI3BM,cAAe,SAASC,EAAMC,uBACxBC,EAAOD,KAAgD,IAAjBA,EAAOE,MACxCH,EAAO,KAAOC,EAAOE,MAAQ,IAE/BH,GAGTI,cAAe,SAASH,uBAClBC,EAAOD,KAAgD,IAAjBA,EAAOE,MACxC,cAEF,IAGTE,eAAgB,SAASC,QAClBpB,SAAWO,KAAKlB,QAAQgC,SAASC,aACjCpB,SAAWK,KAAKlB,QAAQgC,SAASnB,cACjCqB,iBAAkB,GAMzBC,cAAe,SAASJ,OAGlBK,EADkBC,MAAIN,GACGO,YAGD,MAAxBF,EAAOG,eAA0BH,EAAOvB,WAChCuB,EAAOG,cAEA,SAAbH,EAAOI,QACJC,KAAK,gBAAiB,CAAEzC,QAASkB,KAAKlB,QAASoC,OAAQA,IACtC,QAAbA,EAAOI,SACXzB,EAAE2B,KAAKC,UAAUC,OAAO,wBACxBH,KAAK,eAAgB,CAAEzC,QAASkB,KAAKlB,QAASoC,OAAQA,KACrC,QAAbA,EAAOI,QAEX7B,UAAYO,KAAKP,SACA,UAAbyB,EAAOI,SACXC,KAAK,wBAAyB,CACjCzC,QAASkB,KAAKlB,QACdoC,OAAQA,MAShBS,aAAc,SAASd,4BAEjBJ,EAAOT,KAAKlB,UAAgCkB,KAAKlB,QAAQ8C,QAAQC,MACnEC,YAAgBC,IAAI,WAElBC,EAAKnC,EAAEoC,gBAAgBC,OAASF,EAAKvC,SACrCuC,EAAKnC,EAAEsC,cAAcD,QAAUF,EAAKvC,SAEhCuC,EAAKvC,UACPuC,EAAKnC,EAAEgC,KAAKO,KAAO,OACnBJ,EAAKnC,EAAEgC,KAAKQ,IAAM,OAClBL,EAAKnC,EAAEyC,MAAM3C,UAAW,EACxBqC,EAAKnC,EAAE0C,YAAYC,QACnBR,EAAKT,KAAK,kBAAmB,CAAEzC,QAASkD,EAAKlD,UAC7CkD,EAAKhB,iBAAkB,IAElBgB,EAAKhB,gBAGRgB,EAAKhB,iBAAkB,EAFvBgB,EAAKT,KAAK,eAAgB,CAAEzC,QAASkD,EAAKlD,UAI5CkD,EAAKnC,EAAEgC,KAAKO,KAAO,SACnBJ,EAAKnC,EAAEgC,KAAKQ,IAAM,OAClBL,EAAKnC,EAAEyC,MAAM3C,UAAW,GAE1BqC,EAAKT,KAAK,kBAOhBtB,WAAY,SAASY,QACdhB,EAAEC,SAAS2B,UAAUgB,OAAO,kBAC5BlB,KAAK,gBAMZpB,aAAc,SAASU,QAChBhB,EAAEC,SAAS2B,UAAUC,OAAO,kBAC5BH,KAAK"}